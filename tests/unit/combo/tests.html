<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link type="text/css" href="../../../src/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />
    <link type="text/css" href="../../../src/css/structure/modules/infragistics.ui.shared.css" rel="stylesheet" />
    <link type="text/css" href="../../../src/css/structure/modules/infragistics.ui.combo.css" rel="stylesheet" />
    <link type="text/css" href="../../../src/css/structure/modules/infragistics.ui.validator.css" rel="stylesheet" />
    <link type="text/css" href="../../../src/css/structure/modules/infragistics.ui.popover.css" rel="stylesheet" />
	<link type="text/css" href="../../../src/css/structure/modules/infragistics.ui.notifier.css" rel="stylesheet" />
    <link type="text/css" href="../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
    
    <script type="text/javascript" src="../../../bower_components/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="../../../bower_components/jquery-ui/jquery-ui.js"></script>
    <script type="text/javascript" src="../../../bower_components/jquery-mockjax/src/jquery.mockjax.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.util.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.templating.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.ui.shared.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.datasource.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.ui.combo.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/i18n/infragistics.datasource-en.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/i18n/infragistics.ui.combo-en.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/infragistics.ui.validator.js"></script>
	<script type="text/javascript" src="../../../src/js/modules/infragistics.ui.popover.js"></script>
	<script type="text/javascript" src="../../../src/js/modules/i18n/infragistics.ui.notifier-en.js"></script>
	<script type="text/javascript" src="../../../src/js/modules/infragistics.ui.notifier.js"></script>
	<script type="text/javascript" src="../../../src/js/modules/i18n/infragistics.ui.popover-en.js"></script>
    <script type="text/javascript" src="../../../src/js/modules/i18n/infragistics.ui.validator-en.js"></script>
    
    <script type="text/javascript" src="../../../bower_components/qunit/qunit/qunit.js"></script>
    <script type="text/javascript" src="sample-data/local-data.js"></script>
    <script type="text/javascript" src="sample-data/remote-data.js"></script>
    <style>
        .cont {
            margin-top: 75px;
        }
    </style>
</head>
<body>
    <div style="float: right; width: 400px; overflow: auto; z-index: 100; position: relative;">
        <h1 id="qunit-header">Test results</h1>
        <h2 id="qunit-banner"></h2>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
    </div>
    <div id="combo"></div>
    <div class="cont">
        <div id='combo-json-ds' name="combo-json"></div>
    </div>
    <div class="cont">
        <div id='combo-xml-ds'></div>
    </div>
    <div class="cont bind_select">
        <select id="combo-select-ds">
            <option value="1">John Smith</option>
            <option value="2">Mary Johnson</option>
            <option value="3">Bob Ferguson</option>
        </select>
    </div>
    <div class="cont">
        <div id='combo-function-ds'></div>
    </div>
    <div class="cont">
        <div id='combo-remote-ds'></div>
    </div>
    <div class="cont">
        <div id='combo-div'></div>
    </div>
    <div class="cont">
        <span id='combo-span'></span>
    </div>
    <div class="cont render_input">
        <input id='combo-input' name="input-combo" />
    </div>
    <div class="cont">
        <div id='combo-filtering'></div>
    </div>
    <div class="cont render_select">
        <select id="combo-select" name="select-combo">
            <option value="1">John Smith</option>
            <option value="2">Mary Johnson</option>
            <option value="3">Bob Ferguson</option>
        </select>
    </div>
    <div class="cont">
        <div id='combo-lod'></div>
    </div>
    <div class="cont">
        <div id='combo-highlight'></div>
    </div>
    <div class="cont">
        <div id='combo-scroll'></div>
    </div>
    <div class="cont">
        <div id='combo-virtualization'></div>
    </div>
    <div class="cont">
        <div id='combo-ddopen'></div>
    </div>
    <div class="cont">
        <div id='combo-ddclose'></div>
    </div>
    <div class="cont">
        <div id='combo-selitem'></div>
    </div>
    <div class="cont">
        <div id='combo-ddmode'></div>
    </div>
    <div class="cont">
        <div id='combo-romode'></div>
    </div>
    <div class="cont">
        <div id='combo-rolmode'></div>
    </div>
    <div class="cont">
        <div id='combo-validation'></div>
    </div>
    <div class="cont">
        <div id='combo-keynav'></div>
    </div>
    <div class="cont">
        <div id='combo-keynavmulti'></div>
    </div>
    <div class="cont">
        <div id='combo-keynavmultishift'></div>
    </div>
    <div class="cont">
        <div id='combo-singleseltype'></div>
    </div>
    <div class="cont">
        <div id='combo-multiseltype'></div>
    </div>
    <div class="cont">
        <div id='combo-singleseltypeasfmfalse'></div>
    </div>
    <div class="cont">
        <div id='combo-multiseltypeasfmfalse'></div>
    </div>
    <div class="cont">
        <div id='combo-selectAll'></div>
    </div>
    <div class="cont">
        <div id='combo-getitem'></div>
    </div>
    <div class="cont">
        <div id='combo_numberarray'></div>
    </div>
    <div class="cont">
        <div id='combo_datearray'></div>
    </div>
    <div class="cont">
        <div id='combo-multiSelectionEnabled'></div>
    </div>
    <div class="cont">
        <div id='combo-modeLOD'></div>
    </div>
    <div class="cont">
        <div id='combo-textKey'></div>
    </div>
    <div class="cont">
        <div id='combo-nullPageSize'></div>
    </div>
    <div class="cont">
        <div id='combo-defaultFilteringType'></div>
    </div>
    <div class="cont">
        <div id='combo-disabledOption'></div>
    </div>
    <div class="cont">
        <div id='combo-enableCheckboxes'></div>
    </div>
    <div class="cont">
        <div id='combo-keyNavItem'></div>
    </div>
    <div class="cont">
        <div id='combo-header-footer'></div>
    </div>
    <div class="cont">
        <div id='combo-inputName'></div>
    </div>
    <div class="cont">
        <select id='combo-inputName-element-name' name="original-name"></select>
    </div>
    <div class="cont">
        <div id='combo-null-inputName'></div>
    </div>
    <div class="cont">
        <div id="combo-noMatchFoundText"></div>
    </div>
    <div class="cont">
        <div id="combo-null-noMatchFoundText"></div>
    </div>
    <div class="cont">
        <div id="combo-locale-noMatchFoundText"></div>
    </div>
    <div class="cont">
        <div id="combo-override-locale-noMatchFoundText"></div>
    </div>
    <div class="cont">
        <div id="combo-placeHolder"></div>
    </div>
    <div class="cont">
        <div id="combo-null-placeHolder"></div>
    </div>
    <div class="cont">
        <div id="combo-locale-placeHolder"></div>
    </div>
    <div class="cont">
        <div id="combo-override-locale-placeHolder"></div>
    </div>
    <div class="cont">
        <div id="combo-no-TextKey-prototype"></div>
    </div>
    <div class="cont">
        <select id="combo-multiple-attribute" multiple></select>
    </div>
    <div class="cont">
        <select id="combo-multiple-single-selection" multiple></select>
    </div>
    <div class="cont">
        <select id="combo-multiple-multi-selection" multiple></select>
    </div>
    <div class="cont">
        <div id="combo-dropdown-orientation-with-templates"></div>
    </div>
    <div class="cont">
        <div id="combo-dropdown-orientation-with-templates-bottom"></div>
    </div>
    <div class="cont">
        <div id="combo-dropdown-orientation"></div>
    </div>
    <div class="cont">
        <div id="combo-autoComplete"></div>
    </div>
    <div class="cont">
        <div id="combo-autoComplete-multi"></div>
    </div>
    <div class="cont">
        <div id="combo-autoComplete-case-sensitive"></div>
    </div>
    <div class="cont">
        <div id="combo-grouping-base"></div>
    </div>
    <div class="cont">
        <div id="combo-grouping-sort"></div>
    </div>
    <div class="cont">
        <div id="combo-grouping-select"></div>
    </div>
    <div class="cont">
        <div id="combo-grouping-virtualization"></div>
    </div>
    <div class="cont">
        <div id="combo-lod-local"></div>
    </div>
    <div class="cont">
        <div id="combo-lod-remote"></div>
    </div>
    <div class="cont">
        <div id="combo-lod-items-count"></div>
    </div>
    <div class="cont">
        <div id="combo-remote-filtering-blur"></div>
    </div>
    <script type="text/javascript">
        $(function () {
            var testId_1 = 'igCombo existence',
				testId_2 = 'JSON data binding',
				testId_3 = 'XML data binding',
				testId_4 = 'Select data binding',
				testId_5 = 'Function data binding',
				testId_6 = 'Remote data binding',
				testId_7 = 'Data binding to number array',
				testId_8 = 'Data binding to date array',
				testId_9 = 'Div rendering',
				testId_10 = 'Span rendering',
				testId_11 = 'Input rendering',
				testId_12 = 'Select rendering',
				testId_13 = 'Generate expressions from texts for filtering',
				testId_14 = 'Filtering by texts',
				testId_15 = 'Load on demand last item and scroll visibility',
				testId_16 = 'Highlight',
				testId_17 = 'Scrolling',
				testId_18 = 'Vitualization',
				testId_19 = 'Drop down opening',
				testId_20 = 'Drop down closing',
				testId_21 = 'Item selection',
				testId_22 = 'Drop down mode',
				testId_23 = 'Readonly mode',
				testId_24 = 'Readonlylist mode',
				testId_25 = 'Validation',
				testId_26 = 'Keyboard navigation single selection',
				testId_27 = 'Keyboard navigation multi selection',
				testId_28 = 'Keyboard navigation multi selection shift key',
				testId_29 = 'Single selection typing in input',
				testId_30 = 'Multi selection typing in input',
				testId_31 = 'Single selection typing in input autoSelectFirstMatch false',
				testId_32 = 'Multi selection typing in input autoSelectFirstMatch false',
				testId_33 = 'Item selection multi',
				testId_34 = 'Getting items',
				// Default values
				testId_35 = 'Default value of enable clear button',
				testId_36 = 'Different mode, LOD, textKey',
				testId_37 = 'Null pageSize',
				testId_38 = 'Set default filtering type',
				// Set option
				testId_39 = 'Disabled Combo',
				testId_40 = 'Enable Checkboxes',
				testId_41 = 'Use keyNavItemValue',
				testId_42 = 'Header/footer templates',
				testId_43 = 'Specify inputName',
				testId_44 = 'Specify inputName with element name set',
				testId_45 = 'Set inputName to null',
				// Locale tests
				testId_46 = 'Set noMatchFoundText',
				testId_47 = 'Null noMatchFoundText',
				testId_48 = 'Locale setting noMatchFoundText',
				testId_49 = 'Override locale setting noMatchFoundText',
				testId_50 = 'Set placeHolder',
				testId_51 = 'Null placeHolder',
				testId_52 = 'Locale setting placeHolder',
				testId_53 = 'Override locale setting placeHolder',
				testId_54 = 'No TextKey, data with prototypes',
				testId_55 = 'Multiple selection on <select multiple> element',
				testId_56 = 'Disable multiple selection from option on <select multiple> element',
				testId_57 = 'Enable multiple selection from option on <select multiple> element',
				testId_58 = 'Auto drop down orientation',
				testId_59 = 'Bottom drop down orientation when there is space for top also',
				testId_60 = 'Drop down orientation set from options',
                // autoComplete tests
				testId_61 = 'autoComplete',
                testId_62 = 'autoComplete with multiple selection',
                testId_63 = 'autoComplete with case sensitivity',
                // Grouping tests
				testId_64 = 'Grouping base functionality',
			    testId_65 = 'Grouping sort functionality',
                testId_66 = 'Grouping select item/header',
				// allowCustomValue
                testId_67 = 'Allow custom values with default configuration';
                // Load on demand tests
                testId_68 = 'Load on demand with local filtering type';
                testId_69 = 'Load on demand with remote filtering type';
                testId_70 = 'Load on demand items count when loading new items';
                testId_71 = 'Blur while loading';

            function testDataBinding($combo, expDataView, expSchema) {
                var i, key,
					dataSource = $combo.igCombo('option', 'dataSource'),
					dataView = dataSource.dataView(),
					fields = dataSource.schema().schema.fields;

                // Data view
                strictEqual(dataView.length, expDataView.length, 'Data view length is incorrect');
                for (i = 0; i < dataView.length; i++) {
                    curDataViewItem = dataView[i];

                    for (key in curDataViewItem) {
                        if (curDataViewItem.hasOwnProperty(key)) {
                            strictEqual(curDataViewItem[key], expDataView[i][key], key + ' of data view item ' + i + ' did not match');
                        }
                    }
                }

                // Schema
                strictEqual(fields.length, expSchema.length, 'Schema length is incorrect');
                for (i = 0; i < fields.length; i++) {
                    curSchemaItem = fields[i];

                    for (key in curSchemaItem) {
                        if (curSchemaItem.hasOwnProperty(key)) {
                            strictEqual(curSchemaItem[key], expSchema[i][key], key + ' of schema item ' + i + ' did not match');
                        }
                    }
                }
            }

            function getClassesCount($elem) {
                var classAttr = $elem.attr('class');

                return classAttr ? (classAttr.split(' ')).length : 0;
            }

            function getHighlightedText($input) {
                var selectedText = '';
                if (window.getSelection) {
                    selectedText = window.getSelection().toString();
                }
                else if (document.selection && document.selection.type != 'Control') {
                    selectedText = document.selection.createRange().text;
                }
                return selectedText;
            }

            // Used to get the start and end position of selection in the input
            // For more info see http://stackoverflow.com/questions/4928586/get-caret-position-in-html-input
            function getInputSelection($elem) {
                var normalizedValue, range, textInputRange, len, endRange,
			        start = 0, end = 0, elem = $elem[0];

                if (typeof elem.selectionStart == "number" && typeof elem.selectionEnd == "number") {
                    start = elem.selectionStart;
                    end = elem.selectionEnd;
                } else if (document.selection && document.selection.type != 'Control') {
                    range = document.selection.createRange();

                    if (range && range.parentElement() == $elem) {
                        len = $elem.value.length;
                        normalizedValue = $elem.value.replace(/\r\n/g, "\n");

                        // Create a working TextRange that lives only in the input
                        textInputRange = $elem.createTextRange();
                        textInputRange.moveToBookmark(range.getBookmark());

                        // Check if the start and end of the selection are at the very end
                        // of the input, since moveStart/moveEnd doesn't return what we want
                        // in those cases
                        endRange = $elem.createTextRange();
                        endRange.collapse(false);

                        if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                            start = end = len;
                        } else {
                            start = -textInputRange.moveStart("character", -len);
                            start += normalizedValue.slice(0, start).split("\n").length - 1;

                            if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                                end = len;
                            } else {
                                end = -textInputRange.moveEnd("character", -len);
                                end += normalizedValue.slice(0, end).split("\n").length - 1;
                            }
                        }
                    }
                }

                return {
                    start: start,
                    end: end
                };
            }

            // classes - array of strings (classes) that the element should have
            // attributes - array of objects with key/value attribute pairs that the element should have
            function testElementRendering($elem, elName, elType, width, height, top, left, childrenLen, classes, attributes, tolerance) {
                var curClass, i,
					clasesLen = classes ? classes.length : 0,
					attrLen = attributes ? attributes.length : 0,
					elOffset = $elem.offset();

                strictEqual($elem.length, 1, elName + ' was not rendered');
                ok($elem.is(elType), elName + ' should be div element');

                // Adding tolerance for inconsistencies between the running engine and real browsers
                if (tolerance && tolerance.width) {
                    ok(width - tolerance.width <= $elem.outerWidth() && width + tolerance.width >= $elem.outerWidth(), width, elName + ' width is not correct');
                } else {
                    strictEqual($elem.outerWidth(), width, elName + ' width is not correct');
                }

                strictEqual($elem.outerHeight(), height, elName + ' height is not correct');
                strictEqual(getClassesCount($elem), clasesLen, elName + ' has incorrect classes count');

                for (i = 0; i < clasesLen; i++) {
                    curClass = classes[i];
                    ok($elem.hasClass(curClass), 'Class ' + curClass + ' was not applied to ' + elName);
                }

                for (i = 0; i < attrLen; i++) {
                    curAttr = attributes[i];
                    strictEqual($elem.attr(curAttr.key), curAttr.value, 'The value of ' + curAttr.key + ' attribute should be ' + curAttr.value);
                }

                if (top !== null) {
                    strictEqual(elOffset.top, top, elName + ' top position was incorrect');
                }

                if (left !== null) {
                    strictEqual(elOffset.left, left, elName + ' left position was incorrect');
                }

                strictEqual($elem.children().length, childrenLen, elName + ' has incorrect number of child elements');
            }

            function testComboIsDestroyed($element) {
                if ($element.is("select")) {
                    equal($element.closest(".igcombo-wrapper").length, 0, "The combo wrapper was not removed.");
                    equal($element.attr("name"), "select-combo", "The input name was not moved back to the select element after destroy.");
                } else if ($element.is("div")) {
                    ok(!$element.hasClass("igcombo-wrapper"), "The combo wrapper class was not removed.");
                    equal($element.children().length, 0, "The combo wrapper was not emptied on destroy");
                } else if ($element.is("input")) {
                    equal($element.closest(".igcombo-wrapper").length, 0, "The combo wrapper was not removed.");
                    equal($element.attr("name"), "input-combo", "The input name was not moved back to the input element after destroy.");
                    equal($._data($element[0], "events"), undefined, "The input events were not removed after destroy.");
                }
            }

            function testComboRendering($comboWrapper, width, height, itemsCount, comboExpElem, itemsText) {
                var $parent = $comboWrapper.parent(),
					$combo = $comboWrapper.children('.ui-igcombo'),
					$txtBoxChildren = $combo.children(),
					$ddBtn = $txtBoxChildren.filter('.ui-igcombo-button'),
					$ddIcon = $ddBtn.children('.ui-igcombo-buttonicon'),
					$clearBtn = $txtBoxChildren.filter('.ui-igcombo-clear'),
					$clearIcon = $clearBtn.children('.ui-igcombo-clearicon'),
					$textFieldCont = $txtBoxChildren.filter('.ui-igcombo-fieldholder'),
					$textFieldInput = $textFieldCont.children('.ui-igcombo-field'),
					$hiddenInput = $txtBoxChildren.filter('input'),
					$dropDown = $comboWrapper.children('.ui-igcombo-dropdown'),
					$dropDownListCont = $dropDown.children('.ui-igcombo-list'),
					$dropDownList = $dropDownListCont.children('.ui-igcombo-listitemholder'),
					$listItems = $dropDownList.children(),
					border = 1,
					comboWrapperExpWidth = comboExpWidth = width,
					comboWrapperExpHeight = comboExpHeight = height,
					comboWrapperExpPosTop = comboExpPosTop = $parent.offset().top,
					comboWrapperExpPosLeft = comboExpPosLeft = $parent.offset().left,
					comboOffset = $comboWrapper.offset(),
					ddIconExpWidth = 16,
					ddIconExpHeight = 16,
					ddBtnPadding = 5,
					ddBtnExpWidth = ddIconExpWidth + border + 2 * ddBtnPadding,
					ddBtnExpHeight = comboExpHeight - 2 * border,
					ddBtnExpPosTop = comboWrapperExpPosTop + border,
					ddBtnExpPosLeft = comboExpWidth + comboOffset.left - border - ddBtnExpWidth,
					ddIconExpPosTop = (ddBtnExpHeight - ddIconExpHeight) / 2 + $ddBtn.offset().top,
					ddIconExpPosLeft = ddBtnExpPosLeft + border + ddBtnPadding,
					clearIconExpWidth = 16,
					clearIconExpHeight = 16,
					clearBtnExpWidth = clearIconExpWidth,
					clearBtnExpHeight = comboExpHeight - 2 * border,
					clearBtnExpPosTop = comboWrapperExpPosTop + border,
					clearBtnExpPosLeft = ddBtnExpPosLeft - clearBtnExpWidth,
					clearIconExpPosTop = (clearBtnExpHeight - clearIconExpHeight) / 2 + $clearBtn.offset().top,
					clearIconExpPosLeft = clearBtnExpPosLeft,
					textFieldContExpWidth = comboExpWidth - 2 * border - ddBtnExpWidth,
					textFieldContExpHeight = comboExpHeight - 2 * border,
					textFieldContExpPosTop = comboWrapperExpPosTop + border,
					textFieldContExpPosLeft = comboWrapperExpPosLeft + border,
					textFieldInputExpWidth = textFieldContExpWidth,
					textFieldInputExpHeight = textFieldContExpHeight,
					textFieldInputExpPosTop = textFieldContExpPosTop,
					textFieldInputExpPosLeft = textFieldContExpPosLeft,
					listItemExpHeight = 29,
					dropDownExpWidth = comboExpWidth,
					dropDownExpHeight = itemsCount * listItemExpHeight + border,
					dropDownExpPosTop = comboOffset.top + comboExpHeight,
					dropDownExpPosLeft = comboOffset.left,
					dropDownListContExpWidth = dropDownExpWidth - 2 * border,
					dropDownListContExpHeight = dropDownExpHeight - border,
					dropDownListContExpPosTop = dropDownExpPosTop,
					dropDownListContExpPosLeft = dropDownExpPosLeft + border,
					dropDownListExpWidth = dropDownListContExpWidth,
					dropDownListExpHeight = dropDownListContExpHeight,
					dropDownListExpPosTop = dropDownListContExpPosTop,
					dropDownListExpPosLeft = dropDownListContExpPosLeft,
					listItemExpWidth = dropDownListContExpWidth,
					listItemExpPosTop = dropDownListContExpPosTop,
					listItemExpPosLeft = dropDownListContExpPosLeft,
					i, $curItem;

                // Combo wrapper
                testElementRendering($comboWrapper, 'combo wrapper', comboExpElem, comboWrapperExpWidth, comboWrapperExpHeight,
					comboWrapperExpPosTop, comboWrapperExpPosLeft, 2, ['ui-igcombo-wrapper']);

                // Combo
                testElementRendering($combo, 'combo', 'div', comboExpWidth, comboExpHeight, comboExpPosTop,
					comboExpPosLeft, 4, ['ui-igcombo', 'ui-widget', 'ui-state-default', 'ui-corner-all', 'ui-state-active', 'ui-unselectable']);

                // Drop down button
                testElementRendering($ddBtn, 'drop down button', 'div', ddBtnExpWidth, ddBtnExpHeight, ddBtnExpPosTop, ddBtnExpPosLeft, 1,
					['ui-igcombo-button', 'ui-state-default', 'ui-unselectable', 'ui-igcombo-button-ltr', 'ui-corner-right']);

                // Drop down icon
                testElementRendering($ddIcon, 'drop down icon', 'div', ddIconExpWidth, ddIconExpHeight,
					ddIconExpPosTop, ddIconExpPosLeft, 0, ['ui-igcombo-buttonicon', 'ui-icon-triangle-1-s', 'ui-icon']);

                // Clear button
                // testElementRendering($clearBtn, 'clear button', 'div', clearBtnExpWidth, clearBtnExpHeight,
                //    clearBtnExpPosTop, clearBtnExpPosLeft, 1, ['ui-igcombo-clear', 'ui-unselectable']);

                // Clear icon
                // testElementRendering($clearIcon, 'clear icon', 'div', clearIconExpWidth, clearIconExpHeight,
                //    clearIconExpPosTop, clearIconExpPosLeft, 0, ['ui-igcombo-clearicon', 'ui-icon-circle-close', 'ui-icon']);

                // Text field
                testElementRendering($textFieldCont, 'text field container', 'div', textFieldContExpWidth, textFieldContExpHeight,
					textFieldContExpPosTop, textFieldContExpPosLeft, 1, ['ui-igcombo-fieldholder', 'ui-igcombo-fieldholder-ltr', 'ui-corner-left']);

                // Text field input
                testElementRendering($textFieldInput, 'text field input', 'input', textFieldInputExpWidth, textFieldInputExpHeight,
					textFieldInputExpPosTop, textFieldInputExpPosLeft, 0, ['ui-igcombo-field', 'ui-corner-all']);

                // Hidden input
                testElementRendering($hiddenInput, 'hidden field', 'input', 0, 0, null, null, 0, ['ui-igcombo-hidden-field'], [{ key: 'type', value: 'hidden' }]);

                // Drop down
                testElementRendering($dropDown, 'drop down', 'div', dropDownExpWidth, dropDownExpHeight, dropDownExpPosTop,
					dropDownExpPosLeft, 1, ['ui-igcombo-dropdown', 'ui-widget-content', 'ui-widget', 'ui-corner-all', 'ui-igcombo-orientation-bottom']);

                // Drop down list cont
                // Adding 2 px width tolerance, because the engine does not remove the parent borders width from this element width
                testElementRendering($dropDownListCont, 'drop down list container', 'div', dropDownListContExpWidth, dropDownListContExpHeight, dropDownListContExpPosTop,
					dropDownListContExpPosLeft, 1, ['ui-igcombo-list'], null, { width: border * 2 });

                // Drop down <ul> list
                // Removing this test because of differences between real browser vs the test engine
                //testElementRendering($dropDownList, 'drop down list', 'ul', dropDownListExpWidth, dropDownListExpHeight, dropDownListExpPosTop, dropDownListExpPosLeft, itemsCount, ['ui-igcombo-listitemholder']);
                ok($dropDownList.hasClass('ui-igcombo-listitemholder'), 'Class ui-igcombo-listitemholder was not applied to ul');

                // List items
                for (i = 0; i < $listItems.length; i++) {
                    $curItem = $listItems.eq(i);
                    // Removing this test because of differences between real browser vs the test engine
                    //testElementRendering($curItem, 'list item ' + i, 'li', listItemExpWidth, listItemExpHeight, listItemExpPosTop + i * listItemExpHeight, listItemExpPosLeft, 0, ['ui-igcombo-listitem', 'ui-state-default', 'ui-unselectable']);

                    ok($curItem.hasClass('ui-igcombo-listitem'), 'Class ui-igcombo-listitem was not applied to list item ' + i);
                    ok($curItem.hasClass('ui-state-default'), 'Class ui-state-default was not applied to list item ' + i);
                    ok($curItem.hasClass('ui-unselectable'), 'Class ui-unselectable was not applied to list item ' + i);
                    strictEqual($curItem.text(), itemsText[i], 'Text value of item ' + i + 'did not match');
                }
            }

            function emulateKeyBoard(key, ctrl, shift, alt, element) {
                var keyDown = jQuery.Event("keydown"),
					keyUp = jQuery.Event("keyup");

                keyDown.ctrlKey = keyUp.ctrlKey = ctrl;
                keyDown.altKey = keyUp.altKey = alt;
                keyDown.shiftKey = keyUp.shiftKey = shift;

                switch (key) {
                    case "up": keyDown.keyCode = keyUp.keyCode = $.ui.keyCode.UP; break;
                    case "left": keyDown.keyCode = keyUp.keyCode = $.ui.keyCode.LEFT; break;
                    case "right": keyDown.keyCode = keyUp.keyCode = $.ui.keyCode.RIGHT; break;
                    case "down": keyDown.keyCode = keyUp.keyCode = $.ui.keyCode.DOWN; break;
                    default: keyDown.keyCode = keyUp.keyCode = key; break;
                }

                element.trigger(keyDown);
                element.trigger(keyUp);
            }

            function typeInInput(key, element) {
                var keyDown = jQuery.Event("keydown"),
					keyUp = jQuery.Event("keyup");

                keyDown.keyCode = keyUp.keyCode = key;

                element.trigger(keyDown);
                element.val(key);
                element.trigger(keyUp);
            }

            function clickElement(element, ctrl, shift) {
                var mouseDown = jQuery.Event("mousedown"), mouseUp = jQuery.Event("mouseup");

                mouseUp.ctrlKey = mouseDown.ctrlKey = ctrl === true;
                mouseUp.shiftKey = mouseDown.shiftKey = shift === true;
                mouseDown.which = mouseUp.which = 1;
                element.trigger(mouseDown);
                element.trigger(mouseUp);
            }

            function testComboIsDisabled($element) {
                var $input = $element.igCombo("textInput");

                ok($element.hasClass("ui-state-disabled"), "Combo does not have ui-state-disabled class applied");
                ok($element.hasClass("ui-igCombo-disabled"), "Combo does not have ui-igCombo-disabled class applied");
                strictEqual($input.attr('readonly'), 'readonly', 'Readonly attribute was not applied');
            }

            function testComboIsEnabled($element) {
                var $input = $element.igCombo("textInput");

                strictEqual($element.hasClass("ui-state-disabled"), false, "Combo has ui-state-disabled class applied");
                strictEqual($element.hasClass("ui-igCombo-disabled"), false, "Combo has ui-igCombo-disabled class applied");
                strictEqual($input.attr('readonly'), undefined, 'Readonly attribute is applied');
            }

            function testCheckboxComboItemsExistence($items) {
                var $item;

                for (var i = 0; i < $items.length; i++) {
                    $item = $items.eq(i);

                    // If .find() returns 1 then classes are applied, if return 0 they are not applied
                    strictEqual($item.find("span.ui-igcombo-checkbox.ui-state-default.ui-corner-all.ui-igcheckbox-small").length, 1, "Combo list item[" + i + "] first span does not have ui-igcombo-checkbox ui-state-default ui-corner-all ui-igcheckbox-small classes applied");
                    strictEqual($item.find("span.ui-icon.ui-igcombo-checkbox-off.ui-igcheckbox-small-off").length, 1, "Combo list item[" + i + "] second nested span does not have ui-icon ui-igcombo-checkbox-off ui-igcheckbox-small-off applied");
                    strictEqual($item.find("div.ui-igcombo-listitemtextwithcheckbox").length, 1, "Combo list item[" + i + "] div element does not have ui-igcombo-listitemtextwithcheckbox class applied");
                }
            }
            // Mock remote binding
            $.mockjax({
                url: "http://localhost/api/invoices*",
                dataType: 'json',
                contentType: "application/json",
                responseTime: 500,
                response: function (settings) {
                    var responseText = remoteData;
                    if (settings.data.$filter && settings.data.$filter === "indexof(tolower(ProductName),'pavlova') ge 0") {
                        responseText = $.map(responseText, function (val, i) {
                            if (val.ProductName.toLowerCase().indexOf('pavlova') !== -1) {
                                return val;
                            }
                        });
                    }

                    if (settings.data.$inlinecount && settings.data.$inlinecount === "allpages") {
                        responseText = {
                            "Results": responseText.slice(settings.data.$skip, settings.data.$skip + settings.data.$top),
                            "Count": remoteData.length
                        }
                    }

                    this.responseText = {
                        "d": {
                            "results": responseText
                        }
                    }
                }
            });

            module("igCombo", {
                setup: function () {

                },
                teardown: function () {

                }
            });

            // Combo existence
            test(testId_1, function () {
                var combo = $('#combo-div').igCombo;
                ok($.type(combo) === 'function', 'igCombo is not defined.');
            });

            // Json data binding
            test(testId_2, function () {
                var i, ds,
					$comboWrapper = $('#combo-json-ds'),
					$hiddenInput,
					wrapper,
					dataSource = [{ ID: 1, Name: "John Smith", Age: 45 },
						{ ID: 2, Name: "Mary Johnson", Age: 32 },
						{ ID: 3, Name: "Bob Ferguson", Age: 27 }],
					expSchema = [{
					    name: 'ID',
					    type: 'number'
					}, {
					    name: 'Name',
					    type: 'string'
					}, {
					    name: 'Age',
					    type: 'number'
					}];

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                wrapper = $comboWrapper.igCombo('comboWrapper');
                equal(wrapper[0], $comboWrapper[0], 'comboWrapper does not return the expected wrap element');

                $hiddenInput = $('#combo-json-ds input.ui-igcombo-hidden-field');
                equal($hiddenInput.attr("name"), "combo-json", "The name attribute was not transferred to the hidden input");

                testDataBinding($comboWrapper, dataSource, expSchema);

                $comboWrapper.igCombo("destroy");
                testComboIsDestroyed($comboWrapper);
            });

            // XML Data binding
            test(testId_3, function () {
                var i, ds,
					$comboWrapper = $('#combo-xml-ds'),
					xmlDoc = '<People>' +
								'<Person ID="1" Name="Gustavo Achong" />' +
								'<Person ID="2" Name="Catherine Abel" />' +
								'<Person ID="3" Name="Kim Abercrombie" />' +
							'</People>',
					xmlSchema = new $.ig.DataSchema("xml",
						{
						    searchField: "//Person",
						    fields: [
								{ name: "ID", xpath: "./@ID" },
								{ name: "Name", xpath: "./@Name" }
						    ]
						}
					),
					dataSource = new $.ig.DataSource({
					    type: "xml",
					    dataSource: xmlDoc,
					    schema: xmlSchema
					}),
					expDataView = [{
					    ID: '1',
					    Name: 'Gustavo Achong'
					}, {
					    ID: '2',
					    Name: 'Catherine Abel'
					}, {
					    ID: '3',
					    Name: 'Kim Abercrombie'
					}],
					expSchema = [{
					    name: 'ID',
					    xpath: './@ID'
					}, {
					    name: 'Name',
					    xpath: './@Name'
					}];

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                testDataBinding($comboWrapper, expDataView, expSchema);
            });

            // Select data binding
            test(testId_4, function () {
                var i, ds, $comboWrapper,
					$comboInitElement = $('#combo-select-ds'),
					expDataView = [{ value: "1", text: "John Smith" },
						{ value: "2", text: "Mary Johnson" },
						{ value: "3", text: "Bob Ferguson" }],
					expSchema = [{
					    name: 'value',
					    type: 'string'
					}, {
					    name: 'text',
					    type: 'string'
					}];

                $comboInitElement.igCombo();

                testDataBinding($comboInitElement, expDataView, expSchema);
            });

            // Function data binding
            test(testId_5, function () {
                var i, ds,
					$comboWrapper = $('#combo-function-ds'),
					expDataView = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }],
					expSchema = [{
					    name: 'ID',
					    type: 'number'
					}, {
					    name: 'Name',
					    type: 'string'
					}];

                $comboWrapper.igCombo({
                    dataSource: function () {
                        return [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];
                    },
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                testDataBinding($comboWrapper, expDataView, expSchema);
            });

            // Remote data binding
            test(testId_6, function () {
                var dataSource, dataView, fields,
					$combo = $('#combo-remote-ds'),
					expDataViewLen = 2155;

                $combo.igCombo({
                    textKey: 'ProductName',
                    responseDataKey: "d.results",
                    dataSource: "http://localhost/api/invoices?callback=?",
                    dataSourceType: "json"
                });

                stop();
                $combo.igCombo({
                    dataBound: function (test, ui) {
                        start();

                        dataSource = $combo.igCombo('option', 'dataSource');
                        dataView = dataSource.dataView();
                        strictEqual(dataView.length, expDataViewLen, 'Data view len is incorrect');
                    }
                });
            });

            // Data binding to number array
            test(testId_7, function () {
                var $combo = $('#combo_numberarray'),
					dataSource = [1, 2, 3, 4, 5],
					expData = [{
					    text: 1,
					    value: 1
					}, {
					    text: 2,
					    value: 2
					}, {
					    text: 3,
					    value: 3
					}, {
					    text: 4,
					    value: 4
					}, {
					    text: 5,
					    value: 5
					}],
					expShema = [{
					    name: 'text',
					    type: 'number'
					}, {
					    name: 'value',
					    type: 'number'
					}];

                $combo.igCombo({
                    dataSource: dataSource,
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                testDataBinding($combo, expData, expShema);
            });

            // Data binding to date array
            test(testId_8, function () {
                var comboDataSource, dataView, fields, key, i,
					$combo = $('#combo_datearray'),
					dataSource = [new Date(2015, 0, 1), new Date(2000, 0, 10), new Date(2008, 1, 6), new Date(2012, 7, 22), new Date(1962, 11, 31)],
					expSchema = [{
					    name: 'text',
					    type: 'date'
					}, {
					    name: 'value',
					    type: 'date'
					}],
					expItemsText = ['1/1/2015', '1/10/2000', '2/6/2008', '8/22/2012', '12/31/1962'];

                $combo.igCombo({
                    dataSource: dataSource,
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                comboDataSource = $combo.igCombo('option', 'dataSource');
                dataView = comboDataSource.dataView();
                fields = comboDataSource.schema().schema.fields;
                $items = $combo.igCombo('listItems');

                // Data view
                strictEqual(dataView.length, 5, 'Data view length is incorrect');

                // Schema
                strictEqual(fields.length, expSchema.length, 'Schema length is incorrect');
                for (i = 0; i < fields.length; i++) {
                    curSchemaItem = fields[i];

                    for (key in curSchemaItem) {
                        if (curSchemaItem.hasOwnProperty(key)) {
                            strictEqual(curSchemaItem[key], expSchema[i][key], key + ' of schema item ' + i + ' did not match');
                        }
                    }
                }

                // Rendered items format
                for (i = 0; i < $items.length; i++) {
                    strictEqual($items.eq(i).text(), expItemsText[i], 'Text of list item ' + i + ' did not match');
                }
            });

            // Div rendering
            test(testId_9, function () {
                var $comboWrapper = $('#combo-div'),
					width = 200,
					height = 30,
					itemsCount = 2,
					comboElem = 'div',
					itemsText = ['Tom', 'Jerry'];

                $comboWrapper
					.igCombo({
					    width: width,
					    height: height,
					    animationShowDuration: 0,
					    dropDownAttachedToBody: false,
					    valueKey: 'id',
					    textKey: 'name',
					    dropDownOrientation: 'bottom',
					    dataSource: [{
					        id: '1',
					        name: 'Tom'
					    }, {
					        id: '2',
					        name: 'Jerry'
					    }]
					})
					.igCombo('openDropDown');

                testComboRendering($comboWrapper, width, height, itemsCount, comboElem, itemsText);
            });

            // Span rendering
            test(testId_10, function () {
                var $comboWrapper = $('#combo-span'),
					width = 166,
					height = 32,
					itemsCount = 3,
					comboElem = 'span',
					itemsText = ['Tom', 'Jerry', 'Spiky'];

                $comboWrapper
					.igCombo({
					    width: width,
					    height: height,
					    valueKey: 'id',
					    textKey: 'name',
					    animationShowDuration: 0,
					    dropDownAttachedToBody: false,
					    dropDownOrientation: 'bottom',
					    dataSource: [{
					        id: '1',
					        name: 'Tom'
					    }, {
					        id: '2',
					        name: 'Jerry'
					    }, {
					        id: '3',
					        name: 'Spiky'
					    }]
					})
					.igCombo('openDropDown');

                testComboRendering($comboWrapper, width, height, itemsCount, comboElem, itemsText);
            });

            // Input rendering
            test(testId_11, function () {
                var $comboElement = $('#combo-input'),
					$hiddenInput,
					width = 333,
					height = 40,
					itemsCount = 4,
					comboElem = 'div',
					itemsText = ['Tom', 'Jerry', 'Spiky', 'Bendji'];

                $comboElement
					.igCombo({
					    width: width,
					    height: height,
					    valueKey: 'id',
					    textKey: 'name',
					    animationShowDuration: 0,
					    dropDownAttachedToBody: false,
					    dropDownOrientation: 'bottom',
					    dataSource: [{
					        id: '1',
					        name: 'Tom'
					    }, {
					        id: '2',
					        name: 'Jerry'
					    }, {
					        id: '3',
					        name: 'Spiky'
					    }, {
					        id: '4',
					        name: 'Bendji'
					    }]
					})
					.igCombo('openDropDown');

                $comboWrapper = $('.render_input').find('.ui-igcombo-wrapper');
                $hiddenInput = $(".render_input input.ui-igcombo-hidden-field");

                equal($hiddenInput.attr("name"), "input-combo", "The name attribute was not transferred to the hidden input");
                testComboRendering($comboWrapper, width, height, itemsCount, comboElem, itemsText);

                $comboElement.igCombo("destroy");
                testComboIsDestroyed($comboElement);
            });

            // Select rendering
            test(testId_12, function () {
                var $comboInitElem = $('#combo-select'),
					$comboWrapper,
					$hiddenInput,
					width = 200, // default
					height = 32, // default
					itemsCount = 3,
					comboElem = 'div',
					itemsText = ['John Smith', 'Mary Johnson', 'Bob Ferguson'];

                $comboInitElem
					.igCombo({
					    animationShowDuration: 0,
					    dropDownAttachedToBody: false,
					    dropDownOrientation: 'bottom'
					})
					.igCombo('openDropDown');

                // Init on select auto selects first element
                $comboInitElem.igCombo('deselect');

                $comboWrapper = $('.render_select div.ui-igcombo-wrapper');
                $hiddenInput = $('.render_select input.ui-igcombo-hidden-field');

                testComboRendering($comboWrapper, width, height, itemsCount, comboElem, itemsText);
                equal($hiddenInput.attr("name"), "select-combo", "The name attribute was not transferred to the input element");
                $comboInitElem.igCombo("destroy");
                testComboIsDestroyed($comboInitElem);
            });

            // Filtering
            test(testId_13, function () {
                var resultText, resultTexts,
					combo = $('#combo-div').data().igCombo,

					// text
					inputText = "Bob",
					expectedTextResult = [{
					    cond: "contains",
					    expr: "Bob",
					    fieldName: "name"
					}],

					// texts
					inputTexts = ["Bob", "Mary"],
					expectedTextsResult = [{
					    cond: "contains",
					    expr: "Bob",
					    fieldName: "name",
					    logic: "OR"
					}, {
					    cond: "contains",
					    expr: "Mary",
					    fieldName: "name",
					    logic: "OR"
					}],

				// not supported types
				inputNotSupportedTexts = [{}, null, undefined];

                resultText = combo._generateExpressions(inputText);
                deepEqual(resultText, expectedTextResult, "The expression from the text is not generated correct.");

                resultTexts = combo._generateExpressions(inputTexts);
                deepEqual(resultTexts, expectedTextsResult, "The expressions from the texts are not generated correct.");

                for (var i = 0; i < inputNotSupportedTexts.length; i++) {
                    throws(
						function () {
						    combo._generateExpressions(inputNotSupportedTexts[i]);
						},
						/*
						function(err) {
						  return err.toString() === "some error description";
						},
						*/
						"raised error on not supported text"
					);
                };

                throws(
					function () {
					    combo._generateExpressions(inputNotSupportedTexts);
					},
					/*
					function(err) {
					  return err.toString() === "some error description";
					},
					*/
					"raised error on not supported texts"
				);
            });

            // Filtering by texts
            test(testId_14, function () {
                var $comboElem = $("#combo-filtering"),
					itemsCount = 40,

					// text
					filteringText = "magna",
					expectedFilteringTextResult = 2,

					// texts
					filteringTexts = ["duis", "dolor"],
					expectedFilteringTextsResult = 3,
					$listItems, combo;

                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    valueKey: 'id',
                    textKey: 'name',
                    dataSource: localData,
                    dataSourceType: "json",
                    filteringType: "local",
                    dropDownAttachedToBody: false
                });

                combo = $comboElem.data().igCombo;

                combo.options.filteringType = "local";

                // local filtering tests
                equal(combo.options.filteringType, "local", "The filtering should be local.");

                combo.filter(filteringText);

                $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children().not('.ui-helper-hidden');

                equal($listItems.length, expectedFilteringTextResult, "The items are not filtered when text is passed.");

                combo.clearFiltering();

                $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children();

                equal($listItems.length, itemsCount, "Clear filtering is not working.");

                combo.filter(filteringTexts);

                $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children().not('.ui-helper-hidden');

                equal($listItems.length, expectedFilteringTextsResult, "The items are not filtered when texts are passed.");

                combo.clearFiltering();

                combo.options.filteringType = "none";

                combo.filter(filteringText);

                $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder')
								.children();

                equal($listItems.length, itemsCount, "The items should not be filtered when filteringType is null.");

                // remote filtering tests
                // TODO: use set methods
                combo.options.filteringType = "remote";
                combo.options.responseDataKey = "d.results";
                combo.options.dataSource = "http://localhost/api/invoices?callback=?";
                combo.options.dataSourceType = "json";
                combo.options.textKey = "ProductName";
                combo._initDataSource();

                equal(combo.options.filteringType, "remote", "The filtering should be remote.");

                combo.filter("pavlova", {});
                stop();
                $comboElem.igCombo({
                    filtered: function (evt, ui) {
                        start();
                        $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder')
                                            .children();

                        equal($listItems.length, 43, "The items should not be filtered when filteringType is null.");
                    }
                });
            });

            // Load on demand last item and scroll visibility
            test(testId_15, function () {
                var $dropDownCont, dropDownContHeight, actualHeight, expectedHeight,
					$comboElem = $("#combo-lod"),
					pageSize = 16;

                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    textKey: 'ProductName',
                    responseDataKey: "d.results.Results",
                    responseTotalRecCountKey: "d.results.Count",
                    dataSource: "http://localhost/api/invoices?callback=?",
                    dataSourceType: "json",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false,
                    loadOnDemandSettings: {
                        enabled: true
                    },
                    itemsRendered: function (evt, ui) {
                        ui.owner.openDropDown(function () {
                            $dropDownCont = $comboElem.find('.ui-igcombo-list');
                            lastItemHeight = $dropDownCont.find("li:last-child").outerHeight();
                            dropDownContHeight = $dropDownCont.height();
                            actualHeight = dropDownContHeight + lastItemHeight;
                            expectedHeight = pageSize * lastItemHeight;

                            equal(actualHeight, expectedHeight, "Last item should be hidden when virtualization is enabled.");

                            notEqual($dropDownCont.prop('scrollHeight'), $dropDownCont.height(), "Scroll should be visible.");
                            
                            start();

                            ui.owner.closeDropDown();
                        });
                    }
                });

                stop();
            });

            // Highlight tests
            test(testId_16, function () {
                var combo, $listItems, $highlightedItems,
					inputText = "john",
					inputTextWithRegex = "jo.*",
					inputEmptyText = "",
					inputTexts = ["bob", "mat", "", "ma.*"],
					$comboElem = $("#combo-highlight");

                $highlightedItems = function () {
                    return $comboElem.igCombo('listItems').find('.ui-igcombo-highlight');
                };

                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    textKey: 'Name',
                    dataSource: [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" },
						{ ID: 4, Name: "Tom Tomov" },
						{ ID: 5, Name: "Stewerd Matewson" },
						{ ID: 6, Name: "David Bengalski" }],
                    dropDownAttachedToBody: false
                });

                combo = $comboElem.data().igCombo;

                combo._highlight(inputText);
                equal($highlightedItems().length, 2, "Correct number items should be highlighted.");

                combo._unhighlight();
                equal($highlightedItems().length, 0, "None of the items should be highlighted.");

                combo._highlight(inputTextWithRegex);
                equal($highlightedItems().length, 0, "None of the items should be highlighted when regex text is passed");

                combo._highlight(inputEmptyText);
                equal($highlightedItems().length, 0, 'None of the should be highlighted when empty text is passed.');

                combo._highlight(inputTexts);
                equal($highlightedItems().length, 2, "Correct number items should be highlighted.");

                // Highlight matches 'null'
                combo._unhighlight();
                combo.options.highlightMatchesMode = null;

                combo._highlight(inputText);
                equal($highlightedItems().length, 0, 'None of items the should be highlighted when highlightMatchesMode is null.');

                // Highlight matches 'startsWith'
                combo._unhighlight();
                combo.options.highlightMatchesMode = 'startsWith';

                combo._highlight(inputText);
                equal($highlightedItems().length, 1, "Correct number items should be highlighted.");

                combo._unhighlight();
                equal($highlightedItems().length, 0, "None of the items should be highlighted.");

                // Highlight matches 'full'
                combo.options.highlightMatchesMode = 'full';
                inputText = "Tom Tomov";

                combo._highlight(inputText);
                equal($highlightedItems().length, 1, "Correct number items should be highlighted.");

                combo._unhighlight();
                equal($highlightedItems().length, 0, "None of the items should be highlighted.");

                inputTexts = ["Tom Tomov", "David Bengalski"];

                combo._highlight(inputTexts);
                equal($highlightedItems().length, 2, "Correct number items should be highlighted.");

                combo._unhighlight();
                equal($highlightedItems().length, 0, "None of the items should be highlighted.");

                // Highligh matches 'contains'
                combo.options.highlightMatchesMode = 'contains';
                //inputText = "jo";

                combo._highlight(inputText);
                equal($highlightedItems().length, 1, "Correct number items should be highlighted.");

                combo._unhighlight();
                equal($highlightedItems().length, 0, "None of the items should be highlighted.");

                combo._highlight(inputTexts);
                equal($highlightedItems().length, 2, "Correct number items should be highlighted.");
            });

            // Scrolling tests
            test(testId_17, function () {
                var combo, $dropDownCont, scrollResult, dropDownContHeight,
					$comboElem = $("#combo-scroll");

                $comboElem.igCombo({
                    textKey: 'name',
                    dataSource: localData,
                    dropDownAttachedToBody: false
                });

                combo = $comboElem.data().igCombo;

                combo.closeDropDown();
                scrollResult = combo.listScrollTop();
                $dropDownCont = $comboElem.find('.ui-igcombo-list');


                notEqual($dropDownCont.css('height'), 0, "The height should be 0.");


                equal(scrollResult, 0, "When value is undefined, then scroll top is returned.");

                combo.closeDropDown();
                scrollResult = combo.listScrollTop(100);

                notEqual($dropDownCont.css('height'), 0, "The height should be 0.");

                equal(scrollResult.widgetName, "igCombo", "Returns reference to igCombo.");

                equal(combo.listScrollTop(), 100, "When value is undefined, then scroll top is returned.");
                equal($dropDownCont.prop('scrollTop'), 100, "Drop down container should be equal to set top scroll.");

                combo.listScrollTop(200);

                equal(combo.listScrollTop(), 200, "When value is undefined, then scroll top is returned.");
                equal($dropDownCont.prop('scrollTop'), 200, "Drop down container should be equal to set top scroll.");

                scrollHeight = $dropDownCont.prop('scrollHeight') - $dropDownCont.innerHeight();

                // set invalid scroll height
                combo.listScrollTop(scrollHeight + 200);

                equal(combo.listScrollTop(), scrollHeight, "When value is invalid, then scroll is max scroll height of the list items.");

                equal($dropDownCont.prop("scrollTop"), scrollHeight, "Drop down container should be equal to max top scroll.");

                combo.listScrollTop(-200);
                equal(combo.listScrollTop(), 0, "When negative value is put, then top scroll is 0.");
            });

            // Virtualization tests
            test(testId_18, function () {
                var combo, $list, $dropDownCont, $scrollCont, $scroll,
					scrollIncrement = 0,
					itemsIncrement = 0,
					itemHeight = 29,
					itemsCount = 40,
					scrollHeight = itemsCount * itemHeight,
					$comboElem = $("#combo-virtualization");

                $comboElem.igCombo({
                    virtualization: true,
                    textKey: 'name',
                    dataSource: localData,
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false
                });

                combo = $comboElem.data().igCombo;
                combo.openDropDown();

                $dropDownCont = $comboElem.find('.ui-igcombo-list');
                $scrollCont = $dropDownCont.children('div');

                $list = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder');

                ok($scrollCont.is('div'), "The scroll container should be div.");
                ok($scrollCont.hasClass('ui-igcombo-scrollholder'), "The scroll container should has ui-igcombo-scrollholder class.");
                ok($scrollCont.hasClass('ui-unselectable'), "The scroll container should not be selectable.");
                equal($scrollCont.css("overflow-y"), "scroll", "The scroll container should has vertical scroll.");
                equal($scrollCont.css("overflow-x"), "hidden", "The scroll container should not has horizontal scroll.");
                equal($scrollCont.css("right"), "0px", "The scroll container should be positioned on the right.");
                equal($dropDownCont.css("overflow"), "hidden", "The list container should be with hidden scrolls.");

                $scroll = $scrollCont.children();

                ok($scroll.is('div'), "The scroll should be div.");
                ok($scroll.hasClass('ui-igcombo-scroll'), "The scroll should has ui-igcombo-scroll class.");
                ok($scroll.hasClass('ui-unselectable'), "The scroll should not be selectable.");
                equal($scroll.height(), scrollHeight, "Scroll has wrong height.");

                $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder')
								.children();

                equal($listItems.length, 15, "15 items should be rendered.");

                $listItems.each(function (i) {
                    ok($(this).text() === localData[i + itemsIncrement].name, "The item value " + $(this).text() + " should be equal to data source value: " + localData[i].name);
                });

                combo.listScrollTop(860);

                stop(); // Pause the test
                //Add your wait
                setTimeout(function () {
                    //Make assertion
                    equal($listItems.length, 15, "15 items should be rendered.");

                    $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder')
									.children();

                    $listItems.each(function (i) {
                        ok($(this).text() === localData[i + 25].name, "The item value " + $(this).text() + " should be equal to data source value: " + localData[i].name);
                    });
                    // After the assertion called, restart the test
                    start();
                }, 10);
            });

            // Drop down opening
            test(testId_19, function () {
                var $dropDown,
					$combo = $('#combo-ddclose'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }],
					itemHeight = 29,
					border = 1,
					dropDownExpHeight = 3 * itemHeight + border,
					isDropDownOpen;

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                $dropDown = $combo.igCombo('dropDown');

                // Open drop down
                $combo.igCombo('openDropDown');

                isDropDownOpen = $combo.igCombo('dropDownOpened');
                strictEqual(isDropDownOpen, true, 'dropDownOpened is incorrect');

                strictEqual($dropDown.outerHeight(), dropDownExpHeight, 'Drop down height is incorrect');

                // Open drop down again
                $combo.igCombo('openDropDown');

                strictEqual($dropDown.outerHeight(), dropDownExpHeight, 'Drop down height is incorrect');
            });

            // Drop down closing
            test(testId_20, function () {
                var $dropDown,
					$combo = $('#combo-ddopen'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                $dropDown = $combo.igCombo('dropDown');

                // Open drop down. Drop down is initially closed
                $combo.igCombo('openDropDown');

                // Close drop down
                $combo.igCombo('closeDropDown');

                strictEqual($dropDown.outerHeight(), 0, 'Drop down height is incorrect');
            });

            // Item selection
            test(testId_21, function () {
                var $hiddenInput, $itemToSel, $input, $selectedItems, $items,
					selectionChangingFires = 0,
					selectionChangedFires = 0,
					$combo = $('#combo-selitem'),
					expInputVal = 'John Smith',
					expHiddenInputVal = '1',
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    initialSelectedItems: [{ index: 1 }]
                });

                $input = $combo.find('.ui-igcombo-field');
                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $itemToSel = $combo.igCombo('dropDown').find('.ui-igcombo-listitem').first();
                $items = $combo.igCombo('dropDown').find('li');

                // Verify initialSelectedItems
                strictEqual($input.val(), "Mary Johnson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "2", 'Hidden input value is incorrect');

                // Select item
                $combo.igCombo('select', $itemToSel);

                strictEqual($input.val(), expInputVal, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), expHiddenInputVal, 'Hidden input value is incorrect');

                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems.length, 1, 'Selected items count is not correct');
                strictEqual($selectedItems[0].data.ID, 1, 'Item data is not correct');
                ok($combo.igCombo('isIndexSelected', 0), 'Item should be selected');
                ok($combo.igCombo('isValueSelected', 1), 'Item should be selected');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // deselect item
                $combo.igCombo('deselect');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems, null, 'Selected items count is not correct');
                ok(!$combo.igCombo('isIndexSelected', 0), 'Item should not be selected');
                ok(!$combo.igCombo('isValueSelected', 1), 'Item should not be selected');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Select item by index
                $combo.igCombo('index', 0);

                strictEqual($input.val(), expInputVal, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), expHiddenInputVal, 'Hidden input value is incorrect');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire 1');

                // deselect item by index
                $combo.igCombo('deselectByIndex', 0);
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Select items by value
                $combo.igCombo('value', 1);

                strictEqual($input.val(), expInputVal, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), expHiddenInputVal, 'Hidden input value is incorrect');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // deselect item by value
                $combo.igCombo('deselectByValue', 3);
                strictEqual($input.val(), expInputVal, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), expHiddenInputVal, 'Hidden input value is incorrect');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Get first selected item by value
                strictEqual($item = $combo.igCombo('value'), 1, 'Item value is not correct');

                // Get first selected item by index
                strictEqual($item = $combo.igCombo('index'), 0, 'Item index is not correct');
            });

            // Drop down mode
            test(testId_22, function () {
                var $input, $item,
					$combo = $('#combo-ddmode'),
					itemHeight = 29,
					border = 1,
					dropDownExpHeight = 3 * itemHeight + border,
					listItemExpWidth = 198,
					listItemExpHeight = itemHeight,
					listItemExpPosLeft = $combo.offset().left + 1,
					listItemExpPosTop = $combo.offset().top + 30,
					click = $.Event('click'),
					mouseEnter = $.Event('mouseenter'),
					mouseLeave = $.Event('mouseleave'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    width: 200,
                    height: 30,
                    dataSource: dataSource,
                    mode: 'dropdown',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false
                });

                $input = $combo.find('.ui-igcombo-field');
                $dropDown = $combo.find('.ui-igcombo-dropdown');
                $item = $combo.find('li').eq(0);

                strictEqual($input.attr('readonly'), 'readonly', 'Readonly attribute was not applied');
                strictEqual($input.hasClass('ui-unselectable'), true, 'Unselectable class was not applied');

                $input.trigger(click); // click on input
                strictEqual($dropDown.outerHeight(), dropDownExpHeight, 'Drop down height is incorrect');

                $item.trigger(mouseEnter); // Hover item
                ok($item.hasClass('ui-state-hover'), 'Class ui-state-hover was not applied to list item 0');

                $item.trigger(mouseLeave);
                ok(!$item.hasClass('ui-state-hover'), 'Class ui-state-hover was not applied to list item 0');

                $input.trigger(click); // click on input
                strictEqual($dropDown.outerHeight(), 0, 'Drop down height is incorrect');
            });

            // Readonly mode
            test(testId_23, function () {
                var $input, $dropDown, $hiddenInput,
					$combo = $('#combo-romode'),
					click = $.Event('click'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    mode: 'readonly',
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                $input = $combo.find('.ui-igcombo-field');
                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $button = $combo.find('.ui-igcombo-button');

                strictEqual($input.attr('readonly'), 'readonly', 'Readonly attribute was not applied');
                strictEqual($input.hasClass('ui-unselectable'), true, 'Unselectable class was not applied');

                strictEqual($input.val(), "1", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "1", 'Hidden input value is incorrect');

                $input.trigger(click); // click on input
                $dropDown = $combo.igCombo('dropDown');
                strictEqual($dropDown.outerHeight(), 0, 'Drop down should not be opened');

                $button.trigger(click); // click on expand button
                $dropDown = $combo.igCombo('dropDown');
                strictEqual($dropDown.outerHeight(), 0, 'Drop down should not be opened');
            });

            // Readonlylist mode
            test(testId_24, function () {
                var $input, $item, $item1, $hiddenInput, $dropDown,
					$combo = $('#combo-rolmode'),
					listItemExpWidth = 198,
					listItemExpHeight = 29,
					listItemExpPosLeft = $combo.offset().left + 1,
					listItemExpPosTop = $combo.offset().top + 30,
					dropDownExpHeight = 3 * listItemExpHeight + 1,
					click = $.Event('click'),
					mouseEnter = $.Event('mouseenter'),
					mouseLeave = $.Event('mouseleave'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    width: 200,
                    height: 30,
                    dataSource: dataSource,
                    mode: 'readonlylist',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false
                });

                $input = $combo.find('.ui-igcombo-field');
                $dropDown = $combo.find('.ui-igcombo-dropdown');
                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $item = $combo.find('li').eq(0);
                $item1 = $combo.find('li').eq(1);

                strictEqual($input.attr('readonly'), 'readonly', 'Readonly attribute was not applied');
                strictEqual($input.hasClass('ui-unselectable'), true, 'Unselectable class was not applied');

                $input.trigger(click); // click on input
                strictEqual($dropDown.outerHeight(), dropDownExpHeight, 'Drop down height is incorrect');

                // Verify first item is selected
                ok($item.hasClass('ui-state-active'), 'Item should be selected');
                strictEqual($input.val(), "1", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "1", 'Hidden input value is incorrect');

                clickElement($item1, false, false); // Click on item

                ok($item.hasClass('ui-state-active'), 'Item should be selected');
                ok(!$item1.hasClass('ui-state-active'), 'Item should not be selected');
                strictEqual($input.val(), "1", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "1", 'Hidden input value is incorrect');

                $item.trigger(mouseEnter);
                ok(!$item1.hasClass('ui-state-hover'), 'Class ui-state-hover was applied to list item 1');

                $item.trigger(mouseLeave);
                ok(!$item1.hasClass('ui-state-hover'), 'Class ui-state-hover was applied to list item 1');
            });

            // Validation
            test(testId_25, function () {
                var validator, validateResult,
					destroy = true,
					$combo = $('#combo-validation'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    validatorOptions: {
                        required: true
                    }
                });

                // Validator
                validator = $combo.igCombo('validator');
                ok($.type(validator) === "object", "Validator should be object.");
                ok(validator.widgetName === "igValidator", "The type of Validator should be igValidator.");

				strictEqual($combo.igCombo('validate'), false, 'Validation error message should be previewed');

			    // Bug #209248 : Error when using igCombo with validatorOptions using closeDropDown()
				$combo.igCombo('openDropDown');
				emulateKeyBoard("down", false, false, false, $combo.igCombo("textInput"));
				$combo.igCombo('closeDropDown'); //causes validation
				strictEqual(validator.isValid(), true, 'Validation should pass when closeDropDown() is called');

                validator = $combo.igCombo('validator', destroy);
                ok(validator === null, "Validator should be null.");

                strictEqual($combo.igCombo('validate'), null, 'Validate should return null when validator is destroyed');
            });

            // Key navigation single selection
            test(testId_26, function () {
                var $input, $items, $hiddenInput, $listItemsDiv,
					$combo = $('#combo-keynav'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					dropDownOpenedFires = 0, dropDownOpeningFires = 0,
					dropDownClosedFires = 0, dropDownClosingFires = 0,
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" },
						{ ID: 4, Name: "Tom Tomov" },
						{ ID: 5, Name: "Stewerd Matewson" },
						{ ID: 6, Name: "David Bengalski" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    dropDownOpening: function (event, args) { dropDownOpeningFires++; },
                    dropDownOpened: function (event, args) { dropDownOpenedFires++; },
                    dropDownClosing: function (event, args) { dropDownClosingFires++; },
                    dropDownClosed: function (event, args) { dropDownClosedFires++; }
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');
                $listItemsDiv = $combo.igCombo('dropDown');
                $items = $listItemsDiv.find('li');

                emulateKeyBoard("down", false, false, false, $input); // key down
                ok($listItemsDiv.height() > 0, 'List items list should  be visible');
                strictEqual(1, dropDownOpeningFires, 'dropDownOpening event should fires');
                strictEqual(1, dropDownOpenedFires, 'dropDownOpened event should fires');
                emulateKeyBoard("down", false, false, false, $input); // key down

                strictEqual($input.val(), "John Smith", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected by key down');
                strictEqual(1, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(1, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard("up", false, false, false, $input); // key up
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected by key up');
                strictEqual($input.val(), "John Smith", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith", 'Hidden input value is incorrect');
                strictEqual(1, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(1, selectionChangedFires, 'selectionChanged event should fires');
                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible');
                strictEqual(1, dropDownClosingFires, 'dropDownClosing event should fires');
                strictEqual(1, dropDownClosedFires, 'dropDownClosed event should fires');

                emulateKeyBoard("down", false, false, true, $input); // alt + key down
                ok($listItemsDiv.height() > 0, 'List items list should  be visible');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual($input.val(), "John Smith", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith", 'Hidden input value is incorrect');
                strictEqual(2, dropDownOpeningFires, 'dropDownOpening event should fires');
                strictEqual(2, dropDownOpenedFires, 'dropDownOpened event should fires');

                emulateKeyBoard("down", false, false, false, $input); // key down
                emulateKeyBoard("down", false, false, false, $input); // key down
                strictEqual($input.val(), "Bob Ferguson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Bob Ferguson", 'Hidden input value is incorrect');
                strictEqual(2, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual(3, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(3, selectionChangedFires, 'selectionChanged event should fires');
                ok($listItemsDiv.height() > 0, 'List items list should  be visible');

                emulateKeyBoard("up", false, false, false, $input); // key up
                strictEqual($input.val(), "Mary Johnson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson", 'Hidden input value is incorrect');
                strictEqual(1, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item was not selected by key down');
                strictEqual(4, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(4, selectionChangedFires, 'selectionChanged event should fires');
                ok($listItemsDiv.height() > 0, 'List items list should be visible');

                emulateKeyBoard(36, true, false, false, $input); // ctrl + home key

                ok($items.eq(0).hasClass('ui-state-active'), 'Item was not selected by home key');
                strictEqual($input.val(), "John Smith", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith", 'Hidden input value is incorrect');
                strictEqual(5, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(5, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard(35, true, false, false, $input); // ctrl + end key

                ok($items.eq(5).hasClass('ui-state-active'), 'Item was not selected by end key');
                strictEqual($input.val(), "David Bengalski", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "David Bengalski", 'Hidden input value is incorrect');
                strictEqual(6, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(6, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard(33, false, false, false, $input); // page up key
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(5).hasClass('ui-state-active'), 'Item was not selected');
                strictEqual($input.val(), "John Smith", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith", 'Hidden input value is incorrect');
                strictEqual(7, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(7, selectionChangedFires, 'selectionChanged event should fires');
                ok($(window).scrollTop() > 0, 'Page should not be scrolled up');

                emulateKeyBoard(34, false, false, false, $input); // page down key
                ok($items.eq(5).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item was not selected');
                strictEqual($input.val(), "David Bengalski", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "David Bengalski", 'Hidden input value is incorrect');
                strictEqual(8, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(8, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard(27, false, false, false, $input); // escape key
                ok($items.eq(5).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual($input.val(), "David Bengalski", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "David Bengalski", 'Hidden input value is incorrect');

                $combo.igCombo('deselect', $items.eq(5)) // deselect item
                ok(!$items.eq(5).hasClass('ui-state-active'), 'Item should not be selected');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                $combo.igCombo('activeIndex', 1) // Set active index to be first item
                strictEqual(1, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be active');

                emulateKeyBoard("up", false, false, true, $input); // alt + arrow up

                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible');
                strictEqual(2, dropDownClosingFires, 'dropDownClosing event should fires');
                strictEqual(2, dropDownClosedFires, 'dropDownClosed event should fires');
            });

            // Key navigation multi selection
            test(testId_27, function () {
                var $input, $items, $hiddenInput, $listItemsDiv, isValueCorrect,
					$combo = $('#combo-keynavmulti'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					dropDownOpenedFires = 0, dropDownOpeningFires = 0,
					dropDownClosedFires = 0, dropDownClosingFires = 0,
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" },
						{ ID: 4, Name: "Tom Tomov" },
						{ ID: 5, Name: "Stewerd Matewson" },
						{ ID: 6, Name: "David Bengalski" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    multiSelection: { enabled: true },
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    dropDownOpening: function (event, args) { dropDownOpeningFires++; },
                    dropDownOpened: function (event, args) { dropDownOpenedFires++; },
                    dropDownClosing: function (event, args) { dropDownClosingFires++; },
                    dropDownClosed: function (event, args) { dropDownClosedFires++; }
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');
                $listItemsDiv = $combo.igCombo('dropDown');
                $items = $listItemsDiv.find('li');

                emulateKeyBoard("down", false, false, false, $input); // key down
                ok($listItemsDiv.height() > 0, 'List items list should  be visible');
                strictEqual(1, dropDownOpeningFires, 'dropDownOpening event should fires');
                strictEqual(1, dropDownOpenedFires, 'dropDownOpened event should fires');

                emulateKeyBoard("down", false, false, false, $input); // key down

                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                strictEqual(0, selectionChangingFires, 'selectionChanging event should not fire');
                strictEqual(0, selectionChangedFires, 'selectionChanged event should not fire');

                emulateKeyBoard("up", false, false, false, $input); // key up
                ok(!$items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be unfocused by key up');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(0, selectionChangingFires, 'selectionChanging event should not fire');
                strictEqual(0, selectionChangedFires, 'selectionChanged event should not fire');
                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible');

                emulateKeyBoard("down", false, false, true, $input); // key down
                ok($listItemsDiv.height() > 0, 'List items list should  be visible after pressing Alt+key down');
                ok(!$items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should not be focused');
                emulateKeyBoard("down", false, false, false, $input); // key down
                ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(2, dropDownOpeningFires, 'dropDownOpening event should fires');
                strictEqual(2, dropDownOpenedFires, 'dropDownOpened event should fires');

                emulateKeyBoard("down", false, false, false, $input); // key down
                emulateKeyBoard("down", false, false, false, $input); // key down
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(2, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                strictEqual(0, selectionChangingFires, 'selectionChanging event should not fire');
                strictEqual(0, selectionChangedFires, 'selectionChanged event should not fire');
                ok($listItemsDiv.height() > 0, 'List items list should  be visible');

                emulateKeyBoard("up", false, false, false, $input); // key up
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                strictEqual(1, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key up');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected by key up');
                strictEqual(0, selectionChangingFires, 'selectionChanging event should not fire');
                strictEqual(0, selectionChangedFires, 'selectionChanged event should not fire');

                emulateKeyBoard(13, false, false, false, $input); // enter key

                // Workaround for issue where the input is not focused when running tests headless, thus 'Mary Jonhson' is without item separator
                isValueCorrect = $input.val() === 'Mary Johnson, ' || $input.val() === 'Mary Johnson';

                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson", 'Hidden input value is incorrect');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected by press Enter');
                strictEqual(1, selectionChangingFires, 'selectionChanging event should fires');
                //strictEqual(1, selectionChangedFires, 'selectionChanged event should not fires');

                emulateKeyBoard("down", false, false, false, $input); // key down
                emulateKeyBoard("down", false, false, false, $input); // key down

                // Workaround for issue where the input is not focused when running tests headless, thus 'Mary Jonhson' is without item separator
                isValueCorrect = $input.val() === 'Mary Johnson, ' || $input.val() === 'Mary Johnson';

                ok(isValueCorrect, 'Input value is incorrect 2');
                strictEqual($hiddenInput.val(), "Mary Johnson", 'Hidden input value is incorrect');
                strictEqual(3, $combo.igCombo('activeIndex'), 'active index is not correct');
                ok($items.eq(3).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                ok(!$items.eq(3).hasClass('ui-state-active'), 'Item should not be selected by key down');
                strictEqual(1, selectionChangingFires, 'selectionChanging event should not fire');
                strictEqual(1, selectionChangedFires, 'selectionChanged event should not fire');

                emulateKeyBoard(13, true, false, false, $input); // ctrl + enter key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Tom Tomov, ' || $input.val() === 'Mary Johnson, Tom Tomov';

                ok(isValueCorrect, 'Input value is incorrect');
                ok($listItemsDiv.height() > 0, 'List items list should be visible after pressing Ctrl+enter');
                strictEqual($hiddenInput.val(), "Mary Johnson, Tom Tomov", 'Hidden input value is incorrect');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual(2, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(2, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard("up", false, false, false, $input); // key up
                emulateKeyBoard("up", false, false, false, $input); // key up

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Tom Tomov, ' || $input.val() === 'Mary Johnson, Tom Tomov';

                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson, Tom Tomov", 'Hidden input value is incorrect');
                strictEqual(1, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key up');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');

                emulateKeyBoard(13, true, false, false, $input); // ctrl + enter key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Tom Tomov, ' || $input.val() === 'Tom Tomov';

                ok(isValueCorrect, 'Input value is incorrect');
                ok($listItemsDiv.height() > 0, 'List items list should be visible after pressing Ctrl+enter');
                strictEqual($hiddenInput.val(), "Tom Tomov", 'Hidden input value is incorrect');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual(3, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(3, selectionChangedFires, 'selectionChanged event should fires');

                $combo.igCombo('activeIndex', 0) // Set active index to be first item
                strictEqual(0, $combo.igCombo('activeIndex'), 'activ index is not correct');
                ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be active');

                emulateKeyBoard(13, true, false, false, $input); // ctrl + enter key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Tom Tomov, John Smith, ' || $input.val() === 'Tom Tomov, John Smith';

                ok(isValueCorrect, 'Input value is incorrect');
                ok($listItemsDiv.height() > 0, 'List items list should be visible after pressing Ctrl+enter');
                strictEqual($hiddenInput.val(), "Tom Tomov, John Smith", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                strictEqual(4, selectionChangingFires, 'selectionChanging event should fires');
                strictEqual(4, selectionChangedFires, 'selectionChanged event should fires');

                emulateKeyBoard("up", false, false, true, $input); // alt + key up
                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Tom Tomov, John Smith, ' || $input.val() === 'Tom Tomov, John Smith';

                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
                strictEqual($hiddenInput.val(), "Tom Tomov, John Smith", 'Hidden input value is incorrect');
            });

            // Keyboard navigation multi selection shift key
            test(testId_28, function () {
                var $input, $items, $hiddenInput, $listItemsDiv, isValueCorrect,
					$combo = $('#combo-keynavmultishift'),
					keyDown = $.Event('keydown'),
					 keyUp = $.Event('keyup'),
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" },
						{ ID: 4, Name: "Tom Tomov" },
						{ ID: 5, Name: "Stewerd Matewson" },
						{ ID: 6, Name: "David Bengalski" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    multiSelection: { enabled: true }
                });

                keyUp.keyCode = keyDown.keyCode = 16; // shift

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');

                emulateKeyBoard("down", false, false, true, $input); // alt + key down
                $listItemsDiv = $combo.igCombo('dropDown');
                $items = $listItemsDiv.find('li');
                ok($listItemsDiv.height() > 0, 'List items list should  be visible after pressing Alt+key down');

                $input.trigger(keyDown); // Press and hold shift key
                emulateKeyBoard("down", false, true, false, $input); // shift + key down
                emulateKeyBoard("down", false, true, false, $input); // shift + key down
                emulateKeyBoard("down", false, true, false, $input); // shift + key down

                ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused by key down');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                $input.trigger(keyUp); // release shift key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'John Smith, Mary Johnson, Bob Ferguson, ' || $input.val() === 'John Smith, Mary Johnson, Bob Ferguson';

                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "John Smith, Mary Johnson, Bob Ferguson", 'Hidden input value is incorrect');

                $combo.igCombo('deselectAll') // Deselect all
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect 1');

                // Go to last position, because deselect all cleared the navigation item
                emulateKeyBoard("down", false, false, false, $input); // key down
                emulateKeyBoard("down", false, false, false, $input); // key down
                emulateKeyBoard("down", false, false, false, $input); // key down
                $input.trigger(keyDown); // Press and hold shift key
                emulateKeyBoard("up", false, true, false, $input); // shift + key up
                ok(!$items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should not be in focused');
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');

                $input.trigger(keyUp); // release shift key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Bob Ferguson, ' || $input.val() === 'Mary Johnson, Bob Ferguson';

                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson, Bob Ferguson", 'Hidden input value is incorrect');

                $input.trigger(keyDown); // Press and hold shift key
                emulateKeyBoard("down", false, true, false, $input); // shift + key down
                emulateKeyBoard("down", false, true, false, $input); // shift + key down
                emulateKeyBoard("down", false, true, false, $input); // shift + key down

                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(3).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(4).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused ');

                emulateKeyBoard("up", false, true, false, $input); // shift + key up
                ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused ');
                ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                ok($items.eq(3).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused ');
                ok(!$items.eq(4).hasClass('ui-igcombo-item-in-focus'), 'Item should not be in focused by key up');

                $input.trigger(keyUp); // release shift key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov, ' || $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov';

                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(4).hasClass('ui-state-active'), 'Item should not be selected');
                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson, Bob Ferguson, Tom Tomov", 'Hidden input value is incorrect');

                $item = $items.eq(5);
                clickElement($item, false, true); // Click item holding shift key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov, Stewerd Matewson, David Bengalski, ' || $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov, Stewerd Matewson, David Bengalski';

                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(4).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(5).hasClass('ui-state-active'), 'Item should be selected');
                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson, Bob Ferguson, Tom Tomov, Stewerd Matewson, David Bengalski", 'Hidden input value is incorrect');

                $item = $items.eq(4);
                clickElement($item, true, false); // Click item holding control key

                // Workaround for issue where the input is not focused when running tests headless and item separator is not added and item separator is not added
                isValueCorrect = $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov, David Bengalski, ' || $input.val() === 'Mary Johnson, Bob Ferguson, Tom Tomov, David Bengalski';

                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                ok($items.eq(3).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(4).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(5).hasClass('ui-state-active'), 'Item should be selected');
                ok(isValueCorrect, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "Mary Johnson, Bob Ferguson, Tom Tomov, David Bengalski", 'Hidden input value is incorrect');

                $combo.igCombo('clearInput') // Clear input
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(4).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(5).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(6).hasClass('ui-state-active'), 'Item should not be selected');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect 1');

                emulateKeyBoard("up", false, false, true, $input); // alt + key up
                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
            });

            // Single selection typing in input
            asyncTest(testId_29, 29, function () {
                var $input, $items, $hiddenInput, $listItemsDiv, $button,
					$combo = $('#combo-singleseltype'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					click = $.Event('click'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; }
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');
                $button = $combo.find('.ui-igcombo-button');

                // 1. Type 'h'
                typeInInput("h", $input);
                setTimeout(function () {
                    start();

                    // Test 'h'
                    $listItemsDiv = $combo.igCombo('dropDown');
                    $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                    ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                    ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                    ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                    strictEqual($input.val(), "h", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "Hana", 'Hidden input value is incorrect');

                    emulateKeyBoard("up", false, false, true, $input); // alt + key up
                    $listItemsDiv = $combo.igCombo('dropDown');
                    $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                    strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
                    ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                    ok($items.eq(7).hasClass('ui-state-active'), 'Item should be selected');
                    strictEqual($input.val(), "Hana", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "Hana", 'Hidden input value is incorrect');

                    // 2. Type 'hn'
                    typeInInput("hn", $input);
                    setTimeout(function () {
                        start();

                        // Test 'hn'
                        $listItemsDiv = $combo.igCombo('dropDown');
                        $items = $listItemsDiv.find('li').not('.ui-helper-hidden');

                        ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                        strictEqual($input.val(), "hn", 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                        ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');

                        $button.trigger(click); // Close drop down

                        $listItemsDiv = $combo.igCombo('dropDown');
                        $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                        strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
                        ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                        ok(!$items.eq(7).hasClass('ui-state-active'), 'Item should not be selected');
                        strictEqual($input.val(), "", 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                        // 3. Type 'm'
                        typeInInput("m", $input);
                        setTimeout(function () {
                            start();

                            // Test 'm'
                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                            ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                            ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                            ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                            strictEqual($input.val(), "m", 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Mary", 'Hidden input value is incorrect');

                            $item = $items.eq(0);
                            clickElement($item, false, false); // Click on selected item

                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                            strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after selecting item');
                            ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                            ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                            strictEqual($input.val(), "Mary", 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Mary", 'Hidden input value is incorrect');
                        }, 100);

                        stop();
                    }, 100);

                    stop();
                }, 100);
            });

            // Multi selection typing in input
            asyncTest(testId_30, 28, function () {
                var $input, $items, $hiddenInput, $listItemsDiv, isValueCorrect,
					$combo = $('#combo-multiseltype'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    multiSelection: { enabled: true }
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');

                // 1. Type 'a'
                typeInInput("a", $input);
                setTimeout(function () {
                    start();

                    // Test 'a'
                    $listItemsDiv = $combo.igCombo('dropDown');
                    $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                    ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                    ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should not be focused');
                    ok(!$items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should not be focused');
                    ok($items.eq(2).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                    strictEqual($input.val(), "a", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                    // 2. Type 'a, '
                    typeInInput("a, ", $input);
                    setTimeout(function () {
                        start();

                        // Test 'a, '
                        $listItemsDiv = $combo.igCombo('dropDown');
                        $items = $listItemsDiv.find('li').not('.ui-helper-hidden');

                        ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');

                        // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                        isValueCorrect = $input.val() === 'Anna, ' || $input.val() === 'Anna';

                        ok(isValueCorrect, 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "Anna", 'Hidden input value is incorrect');
                        ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                        ok($items.eq(6).hasClass('ui-state-active'), 'Item should be selected');

                        // 3. Type 'Anna, h'
                        typeInInput("Anna, h", $input);
                        setTimeout(function () {
                            start();

                            // Test 'Anna, h'
                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                            ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                            ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                            ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                            ok(!$items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should not be focused');
                            ok($items.eq(1).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                            strictEqual($input.val(), "Anna, h", 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Anna", 'Hidden input value is incorrect');

                            emulateKeyBoard(13, false, false, false, $input); // press enter key
                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');

                            // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                            isValueCorrect = $input.val() === 'Anna, Hana, ' || $input.val() === 'Anna, Hana';

                            ok($listItemsDiv.height() > 0, 'List items list should be visible after press enter key');
                            ok($items.eq(6).hasClass('ui-state-active'), 'Item should be selected');
                            ok($items.eq(7).hasClass('ui-state-active'), 'Item should be selected');
                            ok(isValueCorrect, 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Anna, Hana", 'Hidden input value is incorrect');

                            emulateKeyBoard("up", false, false, true, $input); // alt + key up

                            // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                            isValueCorrect = $input.val() === 'Anna, Hana, ' || $input.val() === 'Anna, Hana';

                            ok(isValueCorrect, 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Anna, Hana", 'Hidden input value is incorrect');
                        }, 100);

                        stop();
                    }, 100);

                    stop();
                }, 100);
            });

            // Single selection typing in input autoSelectFirstMatch false
            asyncTest(testId_31, 28, function () {
                var $input, $items, $hiddenInput, $listItemsDiv,
					$combo = $('#combo-singleseltypeasfmfalse'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					click = $.Event('click'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    autoSelectFirstMatch: false,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; }
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');
                $listItemsDiv = $combo.igCombo('dropDown');
                $button = $combo.find('.ui-igcombo-button');

                // 1. Type 'h'
                typeInInput("h", $input);
                setTimeout(function () {
                    start();

                    // Test 'h'
                    $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                    ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                    ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                    strictEqual($input.val(), "h", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                    emulateKeyBoard("up", false, false, true, $input); // alt + key up
                    $listItemsDiv = $combo.igCombo('dropDown');
                    $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                    strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
                    ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(7).hasClass('ui-state-active'), 'Item should not be selected');
                    strictEqual($input.val(), "", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                    // 2. Type 'hana'
                    typeInInput("hana", $input);
                    setTimeout(function () {
                        start();

                        // Test 'hana'
                        $listItemsDiv = $combo.igCombo('dropDown');
                        $items = $listItemsDiv.find('li').not('.ui-helper-hidden');

                        ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                        strictEqual($input.val(), "hana", 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "Hana", 'Hidden input value is incorrect');
                        ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');

                        $button.trigger(click); // Close drop down

                        $listItemsDiv = $combo.igCombo('dropDown');
                        $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                        strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible');
                        ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                        ok($items.eq(7).hasClass('ui-state-active'), 'Item should be selected');
                        strictEqual($input.val(), "Hana", 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "Hana", 'Hidden input value is incorrect');

                        // 3. Type 'm'
                        typeInInput("m", $input);
                        setTimeout(function () {
                            start();

                            // Test 'm'
                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                            ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                            ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                            strictEqual($input.val(), "m", 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                            $item = $items.eq(0);
                            clickElement($item, false, false); // Click on selected item

                            $listItemsDiv = $combo.igCombo('dropDown');
                            $items = $listItemsDiv.find('li').not('.ui-helper-hidden');
                            strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after selecting item');
                            ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                            ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                            strictEqual($input.val(), "Mary", 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Mary", 'Hidden input value is incorrect');
                        }, 100);

                        stop();
                    }, 100);

                    stop();
                }, 100);
            });

            // Multi selection typing in input autoSelectFirstMatch false
            asyncTest(testId_32, 24, function () {
                var $input, $items, $hiddenInput, $listItemsDiv, isValueCorrect,
					$combo = $('#combo-multiseltypeasfmfalse'),
					selectionChangingFires = 0, selectionChangedFires = 0,
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    multiSelection: { enabled: true },
                    autoSelectFirstMatch: false
                });

                $hiddenInput = $combo.find('.ui-igcombo-hidden-field');
                $input = $combo.find('.ui-igcombo-field');
                $listItemsDiv = $combo.igCombo('dropDown');

                typeInInput("a", $input);
                setTimeout(function () {
                    start();

                    $items = $combo.igCombo('dropDown').find('li').not('.ui-helper-hidden');
                    ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                    ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                    ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                    strictEqual($input.val(), "a", 'Input value is incorrect');
                    strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                    typeInInput("anna", $input);
                    setTimeout(function () {
                        start();

                        $items = $combo.igCombo('dropDown').find('li').not('.ui-helper-hidden');
                        ok($items.eq(0).hasClass('ui-igcombo-item-in-focus'), 'Item should be focused');
                        strictEqual($input.val(), "anna", 'Input value is incorrect');
                        strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');

                        typeInInput("anna, ", $input);
                        setTimeout(function () {
                            start();

                            $items = $combo.igCombo('dropDown').find('li').not('.ui-helper-hidden');

                            // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                            isValueCorrect = $input.val() === 'Anna, ' || $input.val() === 'Anna';

                            ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                            ok(isValueCorrect, 'Input value is incorrect');
                            strictEqual($hiddenInput.val(), "Anna", 'Hidden input value is incorrect');
                            ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                            ok($items.eq(6).hasClass('ui-state-active'), 'Item should be selected');

                            typeInInput("Anna, h", $input);
                            setTimeout(function () {
                                start();

                                $items = $combo.igCombo('dropDown').find('li').not('.ui-helper-hidden');
                                ok($listItemsDiv.height() > 0, 'List items list should be visible after typing in input');
                                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                                strictEqual($input.val(), "Anna, h", 'Input value is incorrect');
                                strictEqual($hiddenInput.val(), "Anna", 'Hidden input value is incorrect');

                                emulateKeyBoard("up", false, false, true, $input); // alt + key up
                                strictEqual(0, $listItemsDiv.height(), 'List items list should not be visible after pressing alt+ key up');
                                $items = $combo.igCombo('dropDown').find('li').not('.ui-helper-hidden');

                                // Workaround for issue where the input is not focused when running tests headless and item separator is not added
                                isValueCorrect = $input.val() === 'Anna, ' || $input.val() === 'Anna';

                                ok($items.eq(6).hasClass('ui-state-active'), 'Item should be selected');
                                ok(!$items.eq(7).hasClass('ui-state-active'), 'Item should be selected');
                                ok(isValueCorrect, 'Input value is incorrect');
                                strictEqual($hiddenInput.val(), "Anna", 'Hidden input value is incorrect');
                            }, 100);

                            stop();
                        }, 100);

                        stop();
                    }, 100);

                    stop();
                }, 100);
            });

            // Select and deselect all items
            test(testId_33, function () {
                var $input, $hiddenInput, $items, $item, selectedIndexes, selectedValues,
					selectionChangingFires = 0,
					selectionChangedFires = 0,
					$combo = $('#combo-selectAll'),
					expInputVal = 'John Smith, Mary Johnson, Bob Ferguson',
					expHiddenInputVal = '1, 2, 3',
					dataSource = [{ ID: 1, Name: "John Smith" },
						{ ID: 2, Name: "Mary Johnson" },
						{ ID: 3, Name: "Bob Ferguson" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    multiSelection: { enabled: true },
                    selectionChanging: function (event, args) { selectionChangingFires++; },
                    selectionChanged: function (event, args) { selectionChangedFires++; },
                    initialSelectedItems: [{ index: 0 }, { value: 3 }]
                });

                $input = $combo.igCombo('textInput');
                $hiddenInput = $combo.igCombo('valueInput');
                $items = $combo.igCombo('dropDown').find('li');

                strictEqual($input.val(), "John Smith, Bob Ferguson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "1, 3", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');

                // Select all items
                $combo.igCombo('selectAll');

                strictEqual($input.val(), expInputVal, 'Input value is incorrect');
                strictEqual($hiddenInput.val(), expHiddenInputVal, 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems.length, 3, 'Selected items count is not correct');
                strictEqual($selectedItems[0].data.ID, 1, 'Item data is not correct');
                strictEqual($selectedItems[1].data.ID, 2, 'Item data is not correct');
                strictEqual($selectedItems[2].data.ID, 3, 'Item data is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Deselect all items
                $combo.igCombo('deselectAll');
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems, null, 'Selected items count is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Select first 2 items
                $combo.igCombo('select', $items.eq(0).add($items.eq(1)), true);

                strictEqual($input.val(), "John Smith, Mary Johnson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "1, 2", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems.length, 2, 'Selected items count is not correct');
                strictEqual($selectedItems[0].data.ID, 1, 'Item data is not correct');
                strictEqual($selectedItems[1].data.ID, 2, 'Item data is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Select last 2 items by index
                $combo.igCombo('index', [1, 2], { additive: true });

                strictEqual($input.val(), "John Smith, Mary Johnson, Bob Ferguson", 'Input value is incorrect 1');
                strictEqual($hiddenInput.val(), "1, 2, 3", 'Hidden input value is incorrect');
                ok($items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems.length, 3, 'Selected items count is not correct');
                strictEqual($selectedItems[0].data.ID, 1, 'Item data is not correct');
                strictEqual($selectedItems[1].data.ID, 2, 'Item data is not correct');
                strictEqual($selectedItems[2].data.ID, 3, 'Item data is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Deselect items by index
                $combo.igCombo('deselectByIndex', [0, 1, 2]);
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems, null, 'Selected items count is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                //Select last 2 items by value
                $combo.igCombo('value', [2, 3], true);

                strictEqual($input.val(), "Mary Johnson, Bob Ferguson", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "2, 3", 'Hidden input value is incorrect');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(1).hasClass('ui-state-active'), 'Item should be selected');
                ok($items.eq(2).hasClass('ui-state-active'), 'Item should be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems.length, 2, 'Selected items count is not correct');
                strictEqual($selectedItems[0].data.ID, 2, 'Item data is not correct');
                strictEqual($selectedItems[1].data.ID, 3, 'Item data is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');

                // Get first selected item by value
                selectedValues = $combo.igCombo('value');
                strictEqual(2, selectedValues.length, 'Item index is not correct');
                strictEqual(2, selectedValues[0], 'Item index is not correct');
                strictEqual(3, selectedValues[1], 'Item index is not correct');

                // Get first selected item by index
                selectedIndexes = $combo.igCombo('index');
                strictEqual(2, selectedIndexes.length, 'Item index is not correct');
                strictEqual(1, selectedIndexes[0], 'Item index is not correct');
                strictEqual(2, selectedIndexes[1], 'Item index is not correct');

                // Deselect items by value
                $combo.igCombo('deselectByValue', [2, 3]);
                strictEqual($input.val(), "", 'Input value is incorrect');
                strictEqual($hiddenInput.val(), "", 'Hidden input value is incorrect');
                ok(!$items.eq(0).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(1).hasClass('ui-state-active'), 'Item should not be selected');
                ok(!$items.eq(2).hasClass('ui-state-active'), 'Item should not be selected');
                $selectedItems = $combo.igCombo('selectedItems');
                strictEqual($selectedItems, null, 'Selected items count is not correct');
                strictEqual(selectionChangingFires, 0, 'selectionChanging event should not fire');
                strictEqual(selectionChangedFires, 0, 'selectionChanged event should not fire');
            });

            // Getting items
            test(testId_34, function () {
                var $item, $liItem,
					$combo = $('#combo-getitem'),
					expID = 3,
					expName = 'Bob',
					expFamale = false,
					dataSource = [{ ID: 1, Name: "John", IsFemale: false },
						{ ID: 2, Name: "Mary", IsFemale: true },
						{ ID: 3, Name: "Bob", IsFemale: false }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0
                });

                $item = $combo.igCombo('itemsFromIndex', 2);
                strictEqual($item.data.ID, expID, 'Item data is not correct');
                strictEqual($item.data.Name, expName, 'Item data is not correct');
                strictEqual($item.data.IsFemale, expFamale, 'Item data is not correct');

                $item = $combo.igCombo('itemsFromIndex', 3);
                strictEqual($item, null, 'Item data is not correct');

                $item = $combo.igCombo('itemsFromValue', 3);
                strictEqual($item.data.ID, expID, 'Item data is not correct');
                strictEqual($item.data.Name, expName, 'Item data is not correct');
                strictEqual($item.data.IsFemale, expFamale, 'Item data is not correct');

                $item = $combo.igCombo('itemsFromValue', 4);
                strictEqual($item, null, 'Item data is not correct');

                $liItem = $combo.igCombo('dropDown').find('li').eq(2);
                $item = $combo.igCombo('itemsFromElement', $liItem);
                strictEqual($item.data.ID, expID, 'Item data is not correct');
                strictEqual($item.data.Name, expName, 'Item data is not correct');
                strictEqual($item.data.IsFemale, expFamale, 'Item data is not correct');

                $liItem = $combo.igCombo('dropDown').find('li').eq(4);
                $item = $combo.igCombo('itemsFromElement', $liItem);
                strictEqual($item, null, 'Item data is not correct');
            });


            // Default value of enable clear button
            test(testId_35, function () {
                var enableClearButtonValue,
					$combo = $('#combo-multiSelectionEnabled'),
					dataSource = [{ ID: 1, Name: "John", IsFemale: false },
						{ ID: 2, Name: "Mary", IsFemale: true },
						{ ID: 3, Name: "Bob", IsFemale: false }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    mode: 'dropdown',
                    multiSelection: {
                        enabled: true
                    }
                });

                enableClearButtonValue = $combo.igCombo('option', 'enableClearButton');
                ok(enableClearButtonValue, 'Enable clear button value is incorrect');
            });

            // Different mode, LOD, textKey
            test(testId_36, function () {
                var lod, comboMode, isValidMode, isValidPageSize, firstComboOptions, secondComboOptions, hasTextKey,
					$firstCombo = $('#combo-modeLOD'),
					$secondCombo = $('#combo-textKey'),
					defaultPageSize = 5,
					dataSource = [{ ID: 1, Name: "John", IsFemale: false },
						{ ID: 2, Name: "Mary", IsFemale: true },
						{ ID: 3, Name: "Bob", IsFemale: false }];

                $firstCombo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    mode: 'test',
                    loadOnDemandSettings: {
                        enabled: true,
                        pageSize: 4
                    }
                });

                firstComboOptions = $firstCombo.igCombo('option');
                lod = firstComboOptions.loadOnDemandSettings;
                comboMode = firstComboOptions.mode;

                isValidMode = (comboMode !== 'editable' &&
					comboMode !== 'dropdown' &&
					comboMode !== 'readonly' &&
					comboMode !== 'readonlylist') ? false : true;

                isValidPageSize = (lod && lod.enabled && lod.pageSize &&
					firstComboOptions.loadOnDemandSettings.pageSize < 5) ? true : false;

                // Check combo mode and page size
                ok(isValidMode, 'Combo mode doesn`t exist');
                strictEqual(isValidPageSize, false, "Invalid pageSize");

                // Missing textKey
                $secondCombo.igCombo({
                    dataSource: dataSource,
                    valueKey: 'ID'
                });

                secondComboOptions = $secondCombo.igCombo('option');
                hasTextKey = ((!secondComboOptions.textKey) && (secondComboOptions.valueKey)) ? true : false;

                strictEqual(hasTextKey, false, 'Missing textKey');
            });

            // Null pageSize
            test(testId_37, function () {
                var lod, comboOptions, invalidPageSize,
					$combo = $('#combo-nullPageSize'),
					expVisibleItemCount = 10,
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" },
						{ ID: 9, Name: "Scott" },
						{ ID: 10, Name: "Jason" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    visibleItemsCount: expVisibleItemCount,
                    loadOnDemandSettings: {
                        enabled: true,
                        pageSize: null
                    }
                });

                lod = $combo.igCombo('option', 'loadOnDemandSettings');
                comboOptions = $combo.igCombo('option');
                invalidPageSize = (lod && lod.enabled &&
					(lod.pageSize === expVisibleItemCount + 1)) ? true : false;

                ok(invalidPageSize, 'Invalid pageSize');
            });

            // Default filtering value
            test(testId_38, function () {
                var filteringType,
					$combo = $('#combo-defaultFilteringType'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    filteringType: 'nonExistentType'
                });

                filteringType = $combo.igCombo('option', 'filteringType');

                strictEqual(filteringType, "none", "The filtering type did not match");
            });

            // Disable option
            test(testId_39, function () {
                var $combo = $('#combo-disabledOption'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    disabled: true
                });

                testComboIsDisabled($combo);

                // Enabling again the combo through the options
                $combo.igCombo("option", "disabled", false);
                testComboIsEnabled($combo);

                // Disabling the combo through the options
                $combo.igCombo("option", "disabled", true);
                testComboIsDisabled($combo);
            });

            // Enable checkboxes
            test(testId_40, function () {
                var $listItems,
					$combo = $('#combo-enableCheckboxes'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    dropDownAttachedToBody: false,
                    multiSelection: {
                        enabled: true,
                        showCheckboxes: true
                    }
                });

                $listItems = $combo.igCombo("listItems");

                // Check if checkbox styles are applied to the elements li > span, li > span > span and li > div
                testCheckboxComboItemsExistence($listItems);
            });

            // Use selected keyNavItemValue (Reapply active item)
            //test(testId_41, function () {
            //    var $input,
            //        $combo = $('#combo-keyNavItem');
            //
            //    $combo.igCombo({
            //        dataSource: 'http://localhost/api/invoices?callback=?',
            //        valueKey: 'id',
            //        textKey: 'ProductName',
            //        filteringType: "remote",
            //        responseDataKey: "d.results",
            //        dropDownAttachedToBody: false,
            //        multiSelection: {
            //            enabled: true
            //        }
            //    });
            //
            //    $input = $combo.find('.ui-igcombo-field');
            //
            //    emulateKeyBoard("down", false, false, false, $input); // key down
            //    emulateKeyBoard("down", false, false, false, $input); // key down
            //
            //    $combo.filter("pavlova");
            //
            //
            //
            //
            //    debugger;
            //});

            // Header/footer templates
            test(testId_42, function () {
                var $dropDown, $header, $footer, headerOffsetTop, footerOffsetTop, footerExpOffsetTop,
					$combo = $('#combo-header-footer');

                $combo.igCombo({
                    dataSource: localData,
                    textKey: 'name',
                    valueKey: 'id',
                    headerTemplate: 'Header',
                    footerTemplate: 'Footer',
                    animationDuration: 0,
                    closeDropDownOnBlur: false,
                    dropDownOrientation: 'bottom'
                });

                $combo.igCombo('openDropDown');

                $dropDown = $combo.igCombo('dropDown');
                $list = $combo.igCombo('list');

                // Header
                $header = $dropDown.children('.ui-igcombo-header');
                headerOffsetTop = $header.offset().top - $dropDown.offset().top;

                strictEqual($header.outerHeight(), 21, 'Header height did not match');
                strictEqual(headerOffsetTop, 0, 'Header top position did not match');

                // Footer
                $footer = $dropDown.children('.ui-igcombo-footer');
                footerOffsetTop = $footer.offset().top - $dropDown.offset().top;
                footerExpOffsetTop = $header.outerHeight() + $list.outerHeight();

                strictEqual($footer.outerHeight(), 21, 'Footer height did not match');
                strictEqual(footerOffsetTop, footerExpOffsetTop, 'Footer top position did not match');

                // Scroll the drop down
                $list.scrollTop(200);

                // Header after scrolling
                strictEqual($header.outerHeight(), 21, 'Header height did not match');
                strictEqual(headerOffsetTop, 0, 'Header top position did not match');

                // Footer after scrolling
                strictEqual($footer.outerHeight(), 21, 'Footer height did not match');
                strictEqual(footerOffsetTop, footerExpOffsetTop, 'Footer top position did not match');
            });

            // Specify inputName
            test(testId_43, function () {
                var $comboWrapper = $('#combo-inputName'),
					$hiddenInput,
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }];

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    inputName: 'combo-hidden-name'
                });

                $hiddenInput = $('#combo-inputName input.ui-igcombo-hidden-field');
                equal($hiddenInput.attr("name"), "combo-hidden-name", "The inputName setting was not applied to the hidden input");
            });

            // Specify inputName and element name
            test(testId_44, function () {
                var inputName,
                    $comboWrapper = $('#combo-inputName-element-name'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }];

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    inputName: 'new-input-name'
                });

                inputName = $comboWrapper.igCombo('option', 'inputName');
                equal(inputName, "new-input-name", "The element name attribute overwrote the inputName option");
            });

            // Set inputName to null
            test(testId_45, function () {
                var $comboWrapper = $('#combo-null-inputName'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					inputName;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    inputName: null
                });

                inputName = $comboWrapper.igCombo('option', 'inputName');
                equal(inputName, null, "The inputName setting was not set to null");
            });

            // Set noMatchFoundText
            test(testId_46, function () {
                var $comboWrapper = $('#combo-noMatchFoundText'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					noMatchFoundText;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    noMatchFoundText: 'No matches'
                });

                noMatchFoundText = $comboWrapper.igCombo('option', 'noMatchFoundText');
                equal(noMatchFoundText, 'No matches', 'The noMatchFoundText was not properly applied');
            });

            // Use default value of noMatchFoundText
            test(testId_47, function () {
                var $comboWrapper = $('#combo-null-noMatchFoundText'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					noMatchFoundText;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                noMatchFoundText = $comboWrapper.igCombo('option', 'noMatchFoundText');
                equal(noMatchFoundText, 'No matches found', 'The noMatchFoundText default value was not properly applied');
            });

            // Use noMatchFoundText of locale settings
            test(testId_48, function () {
                var $comboWrapper = $('#combo-locale-noMatchFoundText'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					noMatchFoundText,
					locale = $.ig.Combo.locale;

                $.ig.Combo.locale = {
                    noMatchFoundText: 'No Results locale test'
                };

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                noMatchFoundText = $comboWrapper.igCombo('option', 'noMatchFoundText');
                equal(noMatchFoundText, 'No Results locale test', 'The locale noMatchFoundText was not applied');

                $.ig.Combo.locale = locale;
            });

            // Override locale noMatchFoundText
            test(testId_49, function () {
                var $comboWrapper = $('#combo-override-locale-noMatchFoundText'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					noMatchFoundText,
					locale = $.ig.Combo.locale;

                $.ig.Combo.locale = {
                    noMatchFoundText: 'No Results locale test'
                };

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    noMatchFoundText: 'Matches not found'
                });

                noMatchFoundText = $comboWrapper.igCombo('option', 'noMatchFoundText');
                equal(noMatchFoundText, 'Matches not found', 'The locale noMatchFoundText was not overridden');

                $.ig.Combo.locale = locale;
            });

            // Set placeHolder
            test(testId_50, function () {
                var $comboWrapper = $('#combo-placeHolder'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					placeHolder;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    placeHolder: 'Select value'
                });

                placeHolder = $comboWrapper.igCombo('option', 'placeHolder');
                equal(placeHolder, 'Select value', 'The placeHolder was not properly applied');
            });

            // Use default value of placeHolder
            test(testId_51, function () {
                var $comboWrapper = $('#combo-null-placeHolder'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					placeHolder;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                placeHolder = $comboWrapper.igCombo('option', 'placeHolder');
                equal(placeHolder, 'select...', 'The placeHolder default value was not properly applied');
            });

            // Use locale setting for placeHolder
            test(testId_52, function () {
                var $comboWrapper = $('#combo-locale-placeHolder'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					placeHolder,
					locale = $.ig.Combo.locale;

                $.ig.Combo.locale = {
                    placeHolder: 'Please select...'
                };

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                placeHolder = $comboWrapper.igCombo('option', 'placeHolder');
                equal(placeHolder, 'Please select...', 'The locale placeHolder was not applied');

                $.ig.Combo.locale = locale;
            });

            // Override locale setting of placeHolder
            test(testId_53, function () {
                var $comboWrapper = $('#combo-override-locale-placeHolder'),
					dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }],
					placeHolder,
					locale = $.ig.Combo.locale;

                $.ig.Combo.locale = {
                    placeHolder: 'Please select...'
                };

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    placeHolder: 'Select!'
                });

                placeHolder = $comboWrapper.igCombo('option', 'placeHolder');
                equal(placeHolder, 'Select!', 'The locale placeHolder was not overridden');

                $.ig.Combo.locale = locale;
            });

            // Use default value of textKey when data items do not have their own properties
            test(testId_54, function () {
                var $comboWrapper = $('#combo-no-TextKey-prototype'),
					list,
					textKey;

                function testObj() {
                }

                testObj.prototype.key = 5;

                list = [new testObj()];

                $comboWrapper.igCombo({
                    dataSource: list
                });

                textKey = $comboWrapper.igCombo('option', 'textKey');
                equal(textKey, 'text', 'Default value of textKey was not used');
            });

            // Multiple selection should be enabled when a select element is decorated with the multiple attribute
            test(testId_55, function () {
                var multiSelection,
					$comboWrapper = $('#combo-multiple-attribute'),
					dataSource = [
						{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }
					],
					multiSelectionEnabledValue = false;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID'
                });

                multiSelection = $comboWrapper.igCombo('option', 'multiSelection');
                multiSelectionEnabledValue = multiSelection.enabled;
                ok(multiSelectionEnabledValue, 'Multiple selection was not enabled.');
            });

            // If the settings for multiple selection are present they should override the attribute on the element
            test(testId_56, function () {
                var multiSelection,
					$comboWrapper = $('#combo-multiple-single-selection'),
					dataSource = [
						{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }
					],
					multiSelectionEnabledValue = false;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    multiSelection: {
                        enabled: false
                    }
                });

                multiSelection = $comboWrapper.igCombo('option', 'multiSelection');
                multiSelectionEnabledValue = multiSelection.enabled;
                ok(!multiSelectionEnabledValue, 'Multiple selection was not disabled.');
            });

            // If the settings for multiple selection are present they should override the attribute on the element
            test(testId_57, function () {
                var multiSelection,
					$comboWrapper = $('#combo-multiple-multi-selection'),
					dataSource = [
						{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }
					],
					multiSelectionEnabledValue = false;

                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    multiSelection: {
                        enabled: true
                    }
                });

                multiSelection = $comboWrapper.igCombo('option', 'multiSelection');
                multiSelectionEnabledValue = multiSelection.enabled;
                ok(multiSelectionEnabledValue, 'Multiple selection was not enabled.');
            });

            // DropDownOrientation auto
            test(testId_58, function () {
                var offset, dropDownExpPosTop = 184, dropDownExpPosBottom = 307, dropDownExpPosLeft = 250,
                    cssClassOrientaitonBottom = "ui-igcombo-orientation-bottom",
					cssClassOrientaitonTop = "ui-igcombo-orientation-top",
					$comboWrapper = $("#combo-dropdown-orientation-with-templates"),
					ds = [
						{ ID: 1, Name: "John" }, { ID: 2, Name: "Mary" }, { ID: 3, Name: "Bob" }, { ID: 4, Name: "Jack" },
						{ ID: 5, Name: "Dean" }, { ID: 6, Name: "RIchard" }, { ID: 7, Name: "Abraham" }, { ID: 8, Name: "Bobby" },
						{ ID: 9, Name: "Dick" }, { ID: 10, Name: "Debby" }, { ID: 11, Name: "Jacky" }, { ID: 12, Name: "Zuzi" }
					],
					cssOptionsBottom = {
					    position: "absolute",
					    top: "200px",
					    left: "250px"
					},
					cssOptionsTop = {
					    position: "absolute",
					    top: "500px",
					    left: "250px"
					};

                $comboWrapper.igCombo({
                    dataSource: ds,
                    textKey: "Name",
                    valueKey: "ID",
                    headerTemplate: "<div><b>Header template</b></div>",
                    footerTemplate: "<div><b>Footer template</b></div>",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    closeDropDownOnBlur: false,
                    dropDownAttachedToBody: false
                });

                // Apply style for 'bottom' drop down orientation
                $($comboWrapper.parent()[0]).css(cssOptionsBottom);
                $comboWrapper.igCombo("openDropDown");

                // The combo should open to the bottom
                ok($comboWrapper.find(".ui-igcombo-dropdown").hasClass(cssClassOrientaitonBottom), 'Drop down opened to the bottom');

                // And should be at position:
                offset = $comboWrapper.find(".ui-igcombo-dropdown").offset();
                ok((offset.top === dropDownExpPosBottom) && (offset.left === dropDownExpPosLeft), 'Drop down opened at the expected position');

                $comboWrapper.igCombo("closeDropDown");

                // Apply style for 'top' drop down orientation
                $($comboWrapper.parent()[0]).css(cssOptionsTop);
                $comboWrapper.igCombo("openDropDown");

                // The combo should open to the bottom
                ok($comboWrapper.find(".ui-igcombo-dropdown").hasClass(cssClassOrientaitonTop), 'Drop down opened to the top');

                // And should be at position:
                offset = $comboWrapper.find(".ui-igcombo-dropdown").offset();
                ok((offset.top === dropDownExpPosTop) && (offset.left === dropDownExpPosLeft), 'Drop down opened at the expected position');
            });

            // DropDownOrientation bottom
            test(testId_59, function () {
                var cssClassOrientaitonBottom = "ui-igcombo-orientation-bottom",
					$comboWrapper = $("#combo-dropdown-orientation-with-templates-bottom"),
					ds = [
						{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }
					],
					cssOptions = {
					    position: "absolute",
					    top: "250px",
					    left: "550px"
					};

                $comboWrapper.igCombo({
                    dataSource: ds,
                    textKey: "Name",
                    valueKey: "ID",
                    headerTemplate: "<div><b>Header template</b></div>",
                    footerTemplate: "<div><b>Footer template</b></div>",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    closeDropDownOnBlur: false,
                    dropDownAttachedToBody: false
                });

                // Apply style for centered combo, this means that combo can be opened to both top and bottom directions.
                // Although it should open to the bottom.
                $($comboWrapper.parent()[0]).css(cssOptions);
                $comboWrapper.igCombo("openDropDown");

                // The combo should open to bottom
                ok($comboWrapper.find(".ui-igcombo-dropdown").hasClass(cssClassOrientaitonBottom), 'Drop down opened to the bottom and not to the top');
            });

            test(testId_60, function () {
                var cssClassOrientaitonBottom = "ui-igcombo-orientation-bottom",
					cssClassOrientaitonTop = "ui-igcombo-orientation-top",
					$comboWrapper = $("#combo-dropdown-orientation"),
					ds = [
						{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" }
					];

                $comboWrapper.igCombo({
                    dataSource: ds,
                    textKey: "Name",
                    valueKey: "ID",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false,
                    dropDownOrientation: "top"
                });

                $comboWrapper.igCombo("openDropDown");

                // Check 'top' drop down orientation
                ok($comboWrapper.find(".ui-igcombo-dropdown").hasClass(cssClassOrientaitonTop), 'Drop down is correctly opened to the top');

                // Set 'bottom' drop down orientation
                $comboWrapper.igCombo("option", "dropDownOrientation", "bottom");

                // Recalculate the drop down orientation by close and open the drop down again
                $comboWrapper.igCombo("closeDropDown");
                $comboWrapper.igCombo("openDropDown");

                // Check 'bottom' drop down orientation
                ok($comboWrapper.find(".ui-igcombo-dropdown").hasClass(cssClassOrientaitonBottom), 'Drop down is correctly opened to the bottom');
            });

            // Test autocomplete
            asyncTest(testId_61, 8, function () {
                var $input, selectedText, selectPositions,
                    $combo = $('#combo-autoComplete'),
                    dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Mike" },
						{ ID: 6, Name: "Michael" },
						{ ID: 7, Name: "Michele" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    autoComplete: true
                });

                $input = $combo.igCombo('textInput');

                typeInInput('t', $input);
                setTimeout(function () {
                    start();
                    strictEqual($input.val(), 'tom', 'Input value is incorrect');

                    // test highlighting
                    selectedText = getHighlightedText($input);
                    strictEqual(selectedText, 'om', 'Selected text is incorrect');

                    // Invalid value
                    typeInInput('Tx', $input);
                    setTimeout(function () {
                        start();
                        strictEqual($input.val(), 'Tx', 'Input value is incorrect');

                        // Multiple entries with same starting letter(s)
                        typeInInput('M', $input);
                        setTimeout(function () {
                            start();
                            strictEqual($input.val(), 'Mary', 'Input value is incorrect');

                            typeInInput('Mi', $input);
                            setTimeout(function () {
                                start();
                                strictEqual($input.val(), 'Mike', 'Input value is incorrect');

                                // Test right arrow
                                emulateKeyBoard('right', false, false, false, $input);
                                setTimeout(function () {
                                    start();
                                    strictEqual($input.val(), 'Mike', 'Input value is incorrect');

                                    typeInInput('M', $input);
                                    setTimeout(function () {
                                        start();

                                        // Test left arrow
                                        emulateKeyBoard('left', false, false, false, $input);
                                        strictEqual($input.val(), 'Mary', 'Input value is incorrect');
                                        selectPositions = getInputSelection($input);
                                        strictEqual(selectPositions.start, 1, 'Caret is not at the correct position');
                                    }, 100);
                                    stop();
                                }, 100);
                                stop();
                            }, 100);
                            stop();
                        }, 100);
                        stop();
                    }, 100);
                    stop();
                }, 100);
            });

            // Autocomplete with multiple selection
            asyncTest(testId_62, 5, function () {
                var $input,
                    $combo = $('#combo-autoComplete-multi'),
                    dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    autoComplete: true,
                    multiSelection: {
                        enabled: true
                    }
                });

                $input = $combo.igCombo('textInput');
                typeInInput('a', $input);
                setTimeout(function () {
                    start();
                    strictEqual($input.val(), 'anna', 'Input value is incorrect');

                    typeInInput('a,', $input);
                    setTimeout(function () {
                        start();
                        strictEqual($input.val(), 'a,', 'Input value is incorrect');

                        typeInInput('a, ', $input);
                        setTimeout(function () {
                            start();
                            isValueCorrect = $input.val() === 'Anna, ' || $input.val() === 'Anna';
                            ok(isValueCorrect, 'Input value is incorrect');

                            typeInInput('Anna,', $input);
                            setTimeout(function () {
                                start();
                                strictEqual($input.val(), 'Anna,', 'Input value is incorrect');

                                typeInInput("Anna, B", $input);
                                setTimeout(function () {
                                    start();
                                    strictEqual($input.val(), 'Anna, Bob', 'Input value is incorrect');
                                }, 100);
                                stop();
                            }, 100);
                            stop();
                        }, 100);
                        stop();
                    }, 100);
                    stop();
                }, 100);
            });

            // Autocomplete with case sensitivity
            asyncTest(testId_63, 3, function () {
                var $input,
                    $combo = $('#combo-autoComplete-case-sensitive'),
                    dataSource = [{ ID: 1, Name: "John" },
						{ ID: 2, Name: "Mary" },
						{ ID: 3, Name: "Bob" },
						{ ID: 4, Name: "Tom" },
						{ ID: 5, Name: "Stewerd" },
						{ ID: 6, Name: "David" },
						{ ID: 7, Name: "Anna" },
						{ ID: 7, Name: "Hana" },
						{ ID: 8, Name: "Betty" }];

                $combo.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    delayInputChangeProcessing: 0,
                    autoComplete: true,
                    caseSensitive: true
                });

                $input = $combo.igCombo('textInput');

                typeInInput('b', $input);
                setTimeout(function () {
                    start();
                    strictEqual($input.val(), 'b', 'Input value is incorrect');

                    typeInInput('B', $input);
                    setTimeout(function () {
                        start();

                        strictEqual($input.val(), 'Bob', 'Input value is incorrect');

                        typeInInput('BO', $input);
                        setTimeout(function () {
                            start();

                            strictEqual($input.val(), 'BO', 'Input value is incorrect');
                        }, 100);
                        stop();
                    }, 100);
                    stop();
                }, 100);
            });

		    // Grouping base functionality
            test(testId_64, function () {
			    var $liItem, $headers, headersState, allItemsState, dataAttrState,
                    $combo = $("#combo-grouping-base"),
			        type1 = "German car",
                    type2 = "Russian car",
			        type3 = "Swedish car",
                    typesCount = 3,
                    car1 = "Saab",
                    car2 = "Volvo",
                    car3 = "Mercedes",
                    car4 = "Moscvitch",
                    car5 = "Audi",
                    car6 = "Lada",
                    car7 = "VW",
                    car8 = "Kamaz",
                    car9 = "Porsche",
                    car10 = "Zil",
			        ds = [
                            { ID: '1', Name: car1, Type: type3 },
                            { ID: '2', Name: car2, Type: type3 },
                            { ID: '3', Name: car3, Type: type1 },
                            { ID: '4', Name: car4, Type: type2 },
                            { ID: '5', Name: car5, Type: type1 },
                            { ID: '6', Name: car6, Type: type2 },
                            { ID: '7', Name: car7, Type: type1 },
                            { ID: '8', Name: car8, Type: type2 },
                            { ID: '9', Name: car9, Type: type1 },
                            { ID: '10', Name: car10, Type: type2 }
			        ];

			    $combo.igCombo({
			        dataSource: ds,
			        textKey: "Name",
			        valueKey: "ID",
			        grouping: {
			            key: 'Type',
			            dir: 'asc'
			        }
			    });
        			    
			    $liItems = $combo.igCombo('dropDown').find('li');
			    $headers = $liItems.filter(".ui-igcombo-group-header");

			    headersState = function () {
			        return $headers.eq(0).text() === type1 &&
                        $headers.eq(1).text() === type2 &&
                        $headers.eq(2).text() === type3;
			    }

			    allItemsState = function () {
			        return $liItems.eq(0).text() === type1 &&			            
                        $liItems.eq(1).text() === car3 &&
                        $liItems.eq(2).text() === car5 &&
                        $liItems.eq(3).text() === car7 &&
                        $liItems.eq(4).text() === car9 &&

                        $liItems.eq(5).text() === type2 &&
			            $liItems.eq(6).text() === car4 &&
                        $liItems.eq(7).text() === car6 &&
                        $liItems.eq(8).text() === car8 &&
                        $liItems.eq(9).text() === car10 &&

                        $liItems.eq(10).text() === type3 &&
			            $liItems.eq(11).text() === car1 &&
                        $liItems.eq(12).text() === car2;
			    }                    

			    dataAttrState = function () {
			        var result = true;

			        for (var i = 0; i < typesCount + ds.length; i++) {
			            if (i === 0 || i === 5 || i === 10) {
			                result = result && !$liItems.eq(i).attr("data-value");
			            } else {
			                result = result && $liItems.eq(i).attr("data-value");
			            }
			        }

			        return !!result;
			    }

                ok(allItemsState(), 'Drop down correctly group its items');
                ok(headersState(), 'Drop down correctly heads its groups');
                ok(dataAttrState(), 'Drop down correctly set data-value attribute');

                $combo.igCombo("openDropDown");

                ok(allItemsState(), 'Drop down correctly group its items');
                ok(headersState(), 'Drop down correctly heads its groups');
                ok(dataAttrState(), 'Drop down correctly set data-value attribute');
			});

		    // Grouping sort functionality
            test(testId_65, function () {
			    var $headers, ascState, descState,
                    $combo = $("#combo-grouping-sort"),                    
			        type1 = "German car",
                    type2 = "Russian car",
			        type3 = "Swedish car",
                    car1 = "Saab",
                    car2 = "Volvo",
                    car3 = "Mercedes",
                    car4 = "Moscvitch",
                    car5 = "Audi",
                    car6 = "Lada",
                    car7 = "VW",
                    car8 = "Kamaz",
                    car9 = "Porsche",
                    car10 = "Zil",
			        ds = [
                            { ID: '1', Name: car1, Type: type3 },
                            { ID: '2', Name: car2, Type: type3 },
                            { ID: '3', Name: car3, Type: type1 },
                            { ID: '4', Name: car4, Type: type2 },
                            { ID: '5', Name: car5, Type: type1 },
                            { ID: '6', Name: car6, Type: type2 },
                            { ID: '7', Name: car7, Type: type1 },
                            { ID: '8', Name: car8, Type: type2 },
                            { ID: '9', Name: car9, Type: type1 },
                            { ID: '10', Name: car10, Type: type2 }
			            ];

			    $combo.igCombo({
			        dataSource: ds,
			        textKey: "Name",
			        valueKey: "ID",
			        grouping: {
			            key: 'Type',
			            dir: 'asc'
			        }
			    });

			    $headers = $combo.igCombo('dropDown').find('li').filter(".ui-igcombo-group-header");

			    ascState = 
                    $headers.eq(0).text() === type1 &&
			        $headers.eq(1).text() === type2 &&
			        $headers.eq(2).text() === type3;			    
                
			    ok(ascState, 'Drop down correctly sort headers in ASC order');
                
			    $combo.igCombo("openDropDown");

			    ok(ascState, 'Drop down correctly sort headers in ASC order');

			    $combo.igCombo("option", "grouping", {
			        key: 'Type',
			        dir: 'desc'
			    });	  

			    $headers = $combo.igCombo('dropDown').find('li').filter(".ui-igcombo-group-header");

			    descState =
                    $headers.eq(0).text() === type3 &&
			        $headers.eq(1).text() === type2 &&
			        $headers.eq(2).text() === type1;

			    ok(descState, 'Drop down correctly sort headers in DESC order');

			    $combo.igCombo("closeDropDown");

			    ok(descState, 'Drop down correctly sort headers in DESC order');
			});

		    // Grouping select item/header
			test(testId_66, function () {
			    var $liItems, state, selectedItem,
                    $combo = $("#combo-grouping-select"),
			        type1 = "German car",
                    type2 = "Russian car",
			        type3 = "Swedish car",
                    car1 = "Saab",
                    car2 = "Volvo",
                    car3 = "Mercedes",
                    car4 = "Moscvitch",
                    car5 = "Audi",
			        ds = [
                            { ID: "1", Name: car1, Type: type3 },
                            { ID: "2", Name: car2, Type: type3 },
                            { ID: "3", Name: car3, Type: type1 },
                            { ID: "4", Name: car4, Type: type2 },
                            { ID: "5", Name: car5, Type: type1 }
			        ];

			    $combo.igCombo({
			        dataSource: ds,
			        textKey: "Name",
			        valueKey: "ID",
			        closeDropDownOnBlur: false,
			        initialSelectedItems: [{ index: 0 }],
			        grouping: {
			            key: 'Type',
			            dir: 'asc'
			        }
			    });    
                
                // code selection	    
			    equal($combo.igCombo("text"), car3, 'Drop down selected item by index');

			    $combo.igCombo('index', 1);
			    equal($combo.igCombo("text"), car5, 'Drop down select item by index');

			    $combo.igCombo('index', 5);
			    ok(!$combo.igCombo("text"), 'Drop down correctly does not select item');

			    $combo.igCombo('value', 1);
			    equal($combo.igCombo("text"), car1, 'Drop down select item by value');

			    $combo.igCombo('value', 6);
			    ok(!$combo.igCombo("text"), 'Drop down correctly does not select item');

			    // mouse selection
			    $combo.igCombo("openDropDown");
                
			    stop();
			    setTimeout(function () {
			        start();
			        $liItems = $combo.igCombo('dropDown').find('li');

			        // click on header
			        clickElement($liItems.eq(0), false, false);
			        stop();
			        setTimeout(function () {
			            start();
			            ok(!$combo.igCombo("selectedItems"), "Combo does not select group header.");

			            // click on item
			            clickElement($liItems.eq(4), false, false);

			            stop();
			            setTimeout(function () {
			                start();
			                selectedItem = $combo.igCombo("selectedItems");
			                state = selectedItem.length === 1 && selectedItem[0] && selectedItem[0].data && selectedItem[0].data === ds[2];

			                ok(state, "Combo selects item.");
			            }, 100);
			        }, 100); 			        
			    }, 200);			    
			});
			
            /* allowCustomValues */
            test(testId_67, function () {
                var i, ds,
					$comboWrapper = $('#combo-json-ds'),
					$hiddenInput,
					$input,
					dataSource = [{ ID: 1, Name: "John Smith", Age: 45 },
						{ ID: 2, Name: "Mary Johnson", Age: 32 },
						{ ID: 3, Name: "Bob Ferguson", Age: 27 }],
					expSchema = [{
					    name: 'ID',
					    type: 'number'
					}, {
					    name: 'Name',
					    type: 'string'
					}, {
					    name: 'Age',
					    type: 'number'
					}];
                $comboWrapper.igCombo({
                    dataSource: dataSource,
                    textKey: 'Name',
                    valueKey: 'ID',
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    allowCustomValue: true
                });
                $input = $comboWrapper.igCombo("textInput");
                $hiddenInput = $comboWrapper.igCombo("valueInput");
                $input.click();
                typeInInput("a", $input);
                $comboWrapper.igCombo("refreshValue");
                equal($input.val(), "a", "The value of the input is not the input 'a'");
                equal($hiddenInput.val(), "a", "The value of the hidden input is not the input 'a'");
                equal($comboWrapper.igCombo("text"), "a", "The text API didn't return the correct value.");
                equal($comboWrapper.igCombo("value"), "a", "The value API didn't return the correct value.");
                $comboWrapper.igCombo("value", "ab");
                equal($input.val(), "ab", "The value of the input is not the input 'ab' after using the value setter");
                equal($hiddenInput.val(), "ab", "The value of the hidden input is not the input 'ab' after using the value setter");
                equal($comboWrapper.igCombo("text"), "ab", "The text API didn't return the correct value.");
                equal($comboWrapper.igCombo("value"), "ab", "The value API didn't return the correct value.");
                $comboWrapper.igCombo("text", "abc");
                equal($input.val(), "abc", "The value of the input is not the input 'ab' after using the text setter");
                equal($hiddenInput.val(), "ab", "The value of the hidden input is not the input 'ab' after using the text setter");
                equal($comboWrapper.igCombo("text"), "abc", "The text API didn't return the correct value.");
                equal($comboWrapper.igCombo("value"), "ab", "The value API didn't return the correct value.");
                $comboWrapper.igCombo("clearInput");
                equal($input.val(), "", "The value of the input is not the input 'ab' after using the text setter");
                equal($hiddenInput.val(), "", "The value of the hidden input is not the input 'ab' after using the text setter");
                equal($comboWrapper.igCombo("text"), "", "The text API didn't return the correct value.");
                equal($comboWrapper.igCombo("value"), "", "The value API didn't return the correct value.");
                $comboWrapper.igCombo("destroy");
            });

            // Load on demand with local filtering type
            test(testId_68, function () {
                var $listItems, combo, jsonSchema, dataSource
                    $comboElem = $("#combo-lod-local")
                    dataSourceUrl = "http://localhost/api/invoices?callback=?";

                jsonSchema = new $.ig.DataSchema("json", {
                    fields: [{ name: "ProductName", type: "string" }]
                });

                dataSource = new $.ig.DataSource({ type: "json", dataSource: dataSourceUrl, schema: jsonSchema }).dataBind();
                
                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    textKey: 'ProductName',
                    responseDataKey: "d.results.Results",
                    responseTotalRecCountKey: "d.results.Count",
                    dataSource: dataSource.data(),
                    dataSourceType: "json",
                    dataSourceUrl: dataSourceUrl,
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false,
                    loadOnDemandSettings: {
                        enabled: true
                    },
                    filteringType: "local",
                    filtered: function (evt, ui) {
                        $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children().not('.ui-helper-hidden');

                        equal($listItems.length, 1, "1 item should be filtered when load on demand is enabled and filteringType is local.");

                        $dropDownCont = $comboElem.find('.ui-igcombo-list');

                        equal($dropDownCont.prop('scrollHeight'), $dropDownCont.height(), "All items should be visible.");

                        start();
                    }
                });

                combo = $comboElem.data().igCombo;

                stop();
                combo.filter("chai", {});
            });

            // Load on demand with remote filtering type
            test(testId_69, function () {
                var $listItems, combo,
                    $comboElem = $("#combo-lod-remote"),
                    itemsRenderedFiredCount = 0,
                    pageSize = 16,
                    itemsRenderedFiredCountForNextChunk = [2, 3],
                    itemsRenderedFiredCountForAssert = 4;

                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    textKey: 'ProductName',
                    responseDataKey: "d.results.Results",
                    responseTotalRecCountKey: "d.results.Count",
                    dataSource: "http://localhost/api/invoices?callback=?",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false,
                    loadOnDemandSettings: {
                        enabled: true
                    },
                    filteringType: "remote",
                    filtered: function (evt, ui) {
                        $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children().not('.ui-helper-hidden');
                        equal($listItems.length, pageSize, "16 items should be filtered when load on demand is enabled and filteringType is remote.");
                    },
                    itemsRendered: function (evt, ui) {
                        itemsRenderedFiredCount++;
                        if ($.inArray(itemsRenderedFiredCount, itemsRenderedFiredCountForNextChunk) != -1) {
                            ui.owner._nextChunk();
                        }

                        if (itemsRenderedFiredCount == itemsRenderedFiredCountForAssert) {
                            $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children().not('.ui-helper-hidden');
                            equal($listItems.length, 43, "43 items should be filtered when load on demand is enabled and filteringType is remote.");

                            start();
                        }
                    }
                });

                combo = $comboElem.data().igCombo;

                stop();
                combo.filter("pavlova", {});
            });

            // Load on demand items count when loading new items
            test(testId_70, function () {
                var $listItems,
					$comboElem = $("#combo-lod-items-count"),
					itemsRenderedFiredCount = 0,
					pageSize = 16,
                    itemsRenderedFiredCountForNextChunk = [1, 2, 3, 4],
                    itemsRenderedFiredCountForFinishingTest = 5;

                $comboElem.igCombo({
                    width: 200,
                    height: 30,
                    textKey: 'ProductName',
                    responseDataKey: "d.results.Results",
                    responseTotalRecCountKey: "d.results.Count",
                    dataSource: "http://localhost/api/invoices?callback=?",
                    dataSourceType: "json",
                    animationShowDuration: 0,
                    animationHideDuration: 0,
                    dropDownAttachedToBody: false,
                    loadOnDemandSettings: {
                        enabled: true
                    },
                    itemsRendered: function (evt, ui) {
                        itemsRenderedFiredCount++;
                        $listItems = $comboElem.find('.ui-igcombo-list .ui-igcombo-listitemholder').children();
                        equal($listItems.length, pageSize * itemsRenderedFiredCount, pageSize * itemsRenderedFiredCount + " items should be loaded when load on demand is enabled.");

                        if ($.inArray(itemsRenderedFiredCount, itemsRenderedFiredCountForNextChunk) != -1) {
                            ui.owner._nextChunk();
                        }

                        if (itemsRenderedFiredCount == itemsRenderedFiredCountForFinishingTest) {
                            start();
                        }
                    }
                });

                stop();
            });

            // While remotely filtering combo is loading and blurred it should clear the input and close dropdown
            test(testId_71, function () {
                var $comboWrapper = $("#combo-remote-filtering-blur"),
                    $input,
                    currentMockjaxSettingsReposnseTime = $.mockjaxSettings.responseTime,
                    requiredMockjaxSettingsReposnseTime = 1000;

                $.mockjaxSettings.responseTime = requiredMockjaxSettingsReposnseTime;

                $comboWrapper.igCombo({
                    dataSource: "http://localhost/api/invoices?callback=?",
                    dataSourceType: "json",
                    textKey: "ProductName",
                    valueKey: "ProductID",
                    responseDataKey: "d.results",
                    filteringType: "remote",
                    autocomplete: true
                });

                $input = $comboWrapper.igCombo("textInput");
                typeInInput("qwerty", $input);

                // We are going to blur in the middle of the loading
                var blurAfter = Math.floor($.mockjaxSettings.responseTime / 2);
                stop();
                setTimeout(function () {
                    $input.blur();
                    $comboWrapper.igCombo({
                        // Filtered event is used because after the dropdown is closed while loading clear filtering is called
                        filtered: function (evt, ui) {
                            strictEqual(ui.owner.dropDownOpened(), false, "Dropdown should be closed when load on demand is enabled and blur while loading.");
                            strictEqual($input.val(), "", "Dropdown input should be empty when load on demand is enabled and blur while loading.");
                            start();
                            $.mockjaxSettings.responseTime = currentMockjaxSettingsReposnseTime;
                        }
                    });
                }, blurAfter)                
            })
        });
    </script>
</body>
</html>
