<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title> Infragistics jQuery Data Source - Tests for general properties, API methods different than filtering, sorting or paging </title> 
	<script type="text/javascript" src="../../../../bower_components/jquery/dist/jquery.js"></script>
	
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.datasource-en.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.datasource.js"></script>
	
	<link type="text/css" href="../../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
	<script type="text/javascript" src="../../../../bower_components/qunit/qunit/qunit.js"></script>
	
	<script type="text/javascript"> 
	 $(function () {
		var dataBindingFired = false, dataBoundFired = false, ds1;
		function loadTestbeds() {
			// define a simple data source control
			ds1 = new $.ig.DataSource();
			ds1.settings.dataBinding = function () { dataBindingFired = true; };
			ds1.settings.dataBound = function () { dataBoundFired = true; };
			ds1.dataBind();
		}
		
		initialized = false;
		module("igDataSource Properties", {
			setup: function() {
				//pause testing until tree is initialized
				if (!initialized) {
					stop();
					loadTestbeds();
					setTimeout(function () { start(); }, 500);
					initialized = true;
				}
			},
			teardown: function() {
			}
		});
			
		test("igDataSource events test: DataBinding", function() {
			
			equal(true, dataBindingFired, true);
		});
		
		test("igDataSource events test: DataBound", function() {

			equal(true, dataBoundFired, true);
		});
		
		test("igDataSource properties test: fields property", function () {
		
			var fields = ds1.fields([{name: "test1"}, {name: "test2"}]).fields();
			equal(2, fields.length, 2);
			
		});
		
		test("igDataSource properties test: Schema property", function () {
		
			var schema = ds1.schema({type:"unknown"}).schema();
			equal("unknown", schema._type, "unknown");
		});
		
		test("igDataSource properties test: paging settings property", function () {
			
			var ps = ds1.pagingSettings({pageSize: 5}).pagingSettings();
			equal(5, ps.pageSize, 5);
			
		});
		
		test("igDataSource properties test: filtering settings property", function () {
		
			var fs = ds1.filterSettings({filterExprUrlKey: "f"}).filterSettings();
			equal("f", fs.filterExprUrlKey, "f");
		});
		
		test("igDataSource properties test: sort settings property", function () {
		
			var ss = ds1.sortSettings({exprString: "col1 ASC"}).sortSettings();
			equal("col1 ASC", ss.exprString, "col1 ASC");
		});
		
		
		test("igDataSource properties test: dataSource property test", function () {
		
			var ds = ds1.dataSource("http://www.infragistics.com").dataSource();
			equal("http://www.infragistics.com", ds, "http://www.infragistics.com");
		});
	
		test("igDataSource properties test: type property test", function () {
		
			var t = ds1.type("unknown").type();
			if ((t === "unknown" || t === "empty") && t !== undefined && t != null) {
				ok (true, "type is ok", true);
			} else {
				ok(false, "type is not ok", false);
			}
			equal("unknown", ds1.settings.type, "unknown");
		});
		
		// page index
		test("igDataSource properties test: page index property", function () {
			
			var ps = ds1.pagingSettings({pageSize: 5}).pagingSettings();
			equal(0, ds1.pageIndex(), 0);
			
		});
		
		// page count
		test("igDataSource properties test: page count property", function () {
			
			var ps = ds1.pagingSettings({pageSize: 5}).pagingSettings();
			equal(1, ds1.pageCount(), 1);
		});	

		// test stringToJSONObject
		test("Test stringToJSONObject", function () {
			var obj = ds1.stringToJSONObject('{"p": 5}');
			ok(obj.p === 5, "Test stringToJSONObject");
			throws(
				function () {
					ds1.stringToJSONObject('{"p": 5');
				},
				function (err) {
					return err.message.indexOf($.ig.DataSourceLocale.locale.errorParsingJsonNoSchema) > -1;
				},
				$.ig.DataSourceLocale.locale.errorParsingJsonNoSchema + " should be thrown"
			);
		});
		
		test("Test creating JSONDataSource", function () {
			 var adventureWorks = {
                "Records": [{
                    "ProductID": 1,
                    "Name": "Adjustable Race",
                    "ProductNumber": "AR-5381"
                }, {
                    "ProductID": 2,
                    "Name": "Bearing Ball",
                    "ProductNumber": "BA-8327"
                }
            ]};
			 var jsonpDs = new $.ig.JSONDataSource({
                        dataSource: adventureWorks,
                        responseDataKey: "Records"
                    });
 
            jsonpDs.dataBind();
			equal(jsonpDs.type(), "json", "Check if dataSource type is correct.");
			equal(jsonpDs.dataView().length, 2, "DataView should contain 2 records.");			
			
			jsonpDs = new $.ig.JSONDataSource();

			equal(jsonpDs.type(), "json", "Check if dataSource type is correct.");			
		});
		
		test("Test creating HtmlTableDataSource ", function () {
			var htmltableDs = new $.ig.HtmlTableDataSource ();
			equal(htmltableDs.type(), "htmlTableDom", "Check if dataSource type is correct.");			
		});
		
		test("Test creating ArrayDataSource  ", function () {
			var arrayDs = new $.ig.ArrayDataSource();
			equal(arrayDs.type(), "array", "Check if dataSource type is correct.");			
		});
		
		test("Test creating RemoteDataSource   ", function () {
			var arrayDs = new $.ig.RemoteDataSource ();
			equal(arrayDs.type(), "remoteUrl", "Check if dataSource type is correct.");			
		});
		
		test("Test creating JSONPDataSource", function () {
			var JSONPDataSource = new $.ig.JSONPDataSource  ();
			equal(JSONPDataSource.settings.responseDataType , "jsonp", "Check if responseDataType is correct.");			
		});
		
		test("Test creating XmlDataSource ", function () {
			var xmlds  = new $.ig.XmlDataSource();
			equal(xmlds.type(), "xml", "Check if dataSource type is correct.");				
		});
		
		test("Test creating FunctionDataSource", function () {
			var funcDs  = new $.ig.FunctionDataSource ();
			equal(funcDs.type(), "function", "Check if dataSource type is correct.");				
		});
	});
	</script>
	
</head>
<body>
<div id="div1"></div>
<div style="float:right;width:400px;overflow:auto"">
    <h1 id="qunit-header">Test results</h1>
     <h2 id="qunit-banner"></h2>
     <h2 id="qunit-userAgent"></h2>
     <ol id="qunit-tests"></ol>
</div>

</body>
</html>